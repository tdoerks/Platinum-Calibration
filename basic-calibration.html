<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic Calibration Service - Calibrations International</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üî¨</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
            color: #020202;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: #223077; /* Cal Intl Navy */
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1em;
        }

        .header .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 9999px; /* Cal Intl style */
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #69B135; /* Cal Intl Green */
            color: white;
        }

        .btn-primary:hover {
            background: #5a9a2d;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(105,177,53,0.3);
        }

        .btn-secondary {
            background: #32373c; /* Cal Intl Charcoal */
            color: white;
        }

        .btn-secondary:hover {
            background: #23282d;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-tabs {
            background: #f8f9fa;
            display: flex;
            border-bottom: 3px solid #223077;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 15px 25px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: #32373c;
            border-bottom: 3px solid transparent;
            margin-bottom: -3px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: rgba(105,177,53,0.1);
            color: #223077;
        }

        .nav-tab.active {
            background: white;
            color: #223077;
            border-bottom-color: #69B135;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #223077;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #69B135;
        }

        .pipette-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .pipette-card:hover {
            box-shadow: 0 4px 12px rgba(34,48,119,0.1);
        }

        .pipette-header {
            background: #f8f9fa;
            color: #223077;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #223077;
        }

        .pipette-header h3 {
            font-size: 17px;
            font-weight: 700;
            color: #223077;
        }

        .pipette-body {
            padding: 20px;
        }

        .pipette-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .checkbox-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #69B135;
        }

        .volume-inputs {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .volume-inputs input {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            text-align: center;
            font-size: 15px;
            font-weight: 600;
        }

        .volume-inputs input:focus {
            outline: none;
            border-color: #69B135;
            box-shadow: 0 0 0 3px rgba(105, 177, 53, 0.1);
        }

        .volume-inputs input.voice-active {
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2);
            animation: pulse-border 1.5s ease-in-out infinite;
        }

        /* Voice Input Styles */
        .voice-button {
            padding: 6px 12px;
            border: 2px solid #28a745;
            background: #28a745;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .voice-button:hover {
            background: #218838;
            border-color: #218838;
            transform: translateY(-1px);
        }

        .voice-button.listening {
            background: #dc3545;
            border-color: #dc3545;
            animation: pulse-button 1.5s ease-in-out infinite;
        }

        .voice-button.listening:hover {
            background: #c82333;
            border-color: #c82333;
        }

        .voice-button:disabled {
            background: #6c757d;
            border-color: #6c757d;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .voice-status {
            font-size: 12px;
            color: #28a745;
            font-weight: 600;
            margin-left: 10px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .voice-status.error {
            color: #dc3545;
        }

        @keyframes pulse-button {
            0%, 100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
        }

        @keyframes pulse-border {
            0%, 100% { border-color: #28a745; }
            50% { border-color: #5cb85c; }
        }

        /* Measurement Section Backgrounds */
        .measurement-section {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .measurement-section-header {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .as-found-section {
            background: #e7f3ff;
            border: 2px solid #b3d9ff;
        }

        .as-found-section .measurement-section-header {
            color: #004080;
        }

        .as-left-section {
            background: #e8f5e9;
            border: 2px solid #a5d6a7;
        }

        .as-left-section .measurement-section-header {
            color: #2e7d32;
        }

        .status-indicator {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-pass {
            background: #d4edda;
            color: #155724;
        }

        .status-fail {
            background: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .progress-bar {
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #69B135 0%, #5a9a2d 100%);
            transition: width 0.3s ease;
        }

        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #69B135;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 9999;
        }

        .save-indicator.show {
            opacity: 1;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px dashed #dee2e6;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        /* Form Section Cards */
        .form-section-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .form-section-header {
            font-size: 20px;
            font-weight: 700;
            color: #223077;
            margin: 0 0 20px 0;
            padding-bottom: 12px;
            border-bottom: 3px solid #69B135;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: #6c757d;
            font-size: 14px;
            margin-left: 4px;
        }

        .tooltip:hover {
            color: #223077;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #223077;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 13px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #223077 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            color: #223077;
            margin-bottom: 10px;
        }

        .modal-message {
            font-size: 16px;
            color: #32373c;
            line-height: 1.5;
        }

        .modal-footer {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Table View Styles */
        .table-container {
            overflow-x: auto;
        }

        .pipette-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .pipette-table th {
            background: #223077;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            white-space: nowrap;
        }

        .pipette-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e9ecef;
        }

        .pipette-table tr:hover {
            background: #f8f9fa;
            cursor: pointer;
        }

        .pipette-table tr:nth-child(even) {
            background: #fafbfc;
        }

        .pipette-table tr:nth-child(even):hover {
            background: #f1f3f5;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .header .controls,
            .nav-tabs,
            .btn {
                display: none !important;
            }
            .container {
                box-shadow: none;
            }
        }

        /* Barcode Scanner Styles */
        .scan-success {
            animation: scanFlash 0.6s ease;
        }

        @keyframes scanFlash {
            0%, 100% {
                background-color: white;
                border-color: #ced4da;
            }
            50% {
                background-color: #d4edda;
                border-color: #28a745;
                box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
            }
        }

        .scan-status-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 14px;
        }

        .scan-counter {
            color: #6c757d;
            font-weight: 600;
        }

        .scan-status {
            color: #28a745;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="saveIndicator" class="save-indicator">Saved ‚úì</div>

    <!-- Modal -->
    <div id="customModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle" class="modal-title">Notice</h2>
            </div>
            <p id="modalMessage" class="modal-message"></p>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button id="modalConfirmBtn" class="btn btn-primary" style="display: none;">Confirm</button>
            </div>
        </div>
    </div>

    <!-- QRCode.js library for label QR code generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
        // Global Variables
        let pipettes = [];
        let currentPipetteId = 0;
        let currentSessionId = null;
        let saveTimeout = null;
        let undoStack = [];
        let redoStack = [];
        const MAX_HISTORY = 20;

        // Barcode Scanner Variables
        let barcodeBuffer = '';
        let lastKeyTime = 0;
        let barcodeScansToday = 0;
        const BARCODE_SCAN_SPEED_MS = 50; // Keys <50ms apart = scanner

        // ========================================
        // ISO 8655 SPECIFICATIONS DATABASE
        // ========================================

        // ISO 8655 specifications for single-channel pipettes
        const isoSpecs = {
            'P-2': {
                0.5: { accuracy: { from: 0.46, to: 0.54, percent: 8.0, ul: 0.04 }, precision: { percent: 4.0, ul: 0.02 } },
                1: { accuracy: { from: 0.94, to: 1.06, percent: 6.0, ul: 0.06 }, precision: { percent: 3.0, ul: 0.03 } },
                2: { accuracy: { from: 1.92, to: 2.08, percent: 4.0, ul: 0.08 }, precision: { percent: 2.0, ul: 0.04 } }
            },
            'P-2.5': {
                0.5: { accuracy: { from: 0.46, to: 0.54, percent: 8.0, ul: 0.04 }, precision: { percent: 4.0, ul: 0.02 } },
                1.25: { accuracy: { from: 1.18, to: 1.32, percent: 5.6, ul: 0.07 }, precision: { percent: 2.8, ul: 0.035 } },
                2.5: { accuracy: { from: 2.40, to: 2.60, percent: 4.0, ul: 0.10 }, precision: { percent: 2.0, ul: 0.05 } }
            },
            'P-10': {
                2: { accuracy: { from: 1.88, to: 2.12, percent: 6.0, ul: 0.12 }, precision: { percent: 3.0, ul: 0.06 } },
                5: { accuracy: { from: 4.80, to: 5.20, percent: 4.0, ul: 0.20 }, precision: { percent: 2.0, ul: 0.10 } },
                10: { accuracy: { from: 9.70, to: 10.30, percent: 3.0, ul: 0.30 }, precision: { percent: 1.5, ul: 0.15 } }
            },
            'P-20': {
                5: { accuracy: { from: 4.80, to: 5.20, percent: 4.0, ul: 0.20 }, precision: { percent: 2.0, ul: 0.10 } },
                10: { accuracy: { from: 9.70, to: 10.30, percent: 3.0, ul: 0.30 }, precision: { percent: 1.5, ul: 0.15 } },
                20: { accuracy: { from: 19.60, to: 20.40, percent: 2.0, ul: 0.40 }, precision: { percent: 1.0, ul: 0.20 } }
            },
            'P-25': {
                5: { accuracy: { from: 4.80, to: 5.20, percent: 4.0, ul: 0.20 }, precision: { percent: 2.0, ul: 0.10 } },
                12.5: { accuracy: { from: 12.25, to: 12.75, percent: 2.0, ul: 0.25 }, precision: { percent: 1.0, ul: 0.125 } },
                25: { accuracy: { from: 24.50, to: 25.50, percent: 2.0, ul: 0.50 }, precision: { percent: 1.0, ul: 0.25 } }
            },
            'P-50': {
                10: { accuracy: { from: 9.70, to: 10.30, percent: 3.0, ul: 0.30 }, precision: { percent: 1.5, ul: 0.15 } },
                25: { accuracy: { from: 24.50, to: 25.50, percent: 2.0, ul: 0.50 }, precision: { percent: 1.0, ul: 0.25 } },
                50: { accuracy: { from: 49.00, to: 51.00, percent: 2.0, ul: 1.00 }, precision: { percent: 1.0, ul: 0.50 } }
            },
            'P-100': {
                20: { accuracy: { from: 19.60, to: 20.40, percent: 2.0, ul: 0.40 }, precision: { percent: 1.0, ul: 0.20 } },
                50: { accuracy: { from: 49.00, to: 51.00, percent: 2.0, ul: 1.00 }, precision: { percent: 1.0, ul: 0.50 } },
                100: { accuracy: { from: 98.50, to: 101.50, percent: 1.5, ul: 1.50 }, precision: { percent: 0.8, ul: 0.80 } }
            },
            'P-200': {
                50: { accuracy: { from: 49.00, to: 51.00, percent: 2.0, ul: 1.00 }, precision: { percent: 1.0, ul: 0.50 } },
                100: { accuracy: { from: 98.50, to: 101.50, percent: 1.5, ul: 1.50 }, precision: { percent: 0.8, ul: 0.80 } },
                200: { accuracy: { from: 197.0, to: 203.0, percent: 1.5, ul: 3.0 }, precision: { percent: 0.8, ul: 1.6 } }
            },
            'P-250': {
                50: { accuracy: { from: 49.00, to: 51.00, percent: 2.0, ul: 1.00 }, precision: { percent: 1.0, ul: 0.50 } },
                125: { accuracy: { from: 123.5, to: 126.5, percent: 1.2, ul: 1.50 }, precision: { percent: 0.7, ul: 0.875 } },
                250: { accuracy: { from: 247.0, to: 253.0, percent: 1.2, ul: 3.0 }, precision: { percent: 0.7, ul: 1.75 } }
            },
            'P-300': {
                50: { accuracy: { from: 49.00, to: 51.00, percent: 2.0, ul: 1.00 }, precision: { percent: 1.0, ul: 0.50 } },
                200: { accuracy: { from: 197.0, to: 203.0, percent: 1.5, ul: 3.0 }, precision: { percent: 0.8, ul: 1.6 } },
                300: { accuracy: { from: 297.0, to: 303.0, percent: 1.0, ul: 3.0 }, precision: { percent: 0.6, ul: 1.8 } }
            },
            'P-500': {
                100: { accuracy: { from: 98.5, to: 101.5, percent: 1.5, ul: 1.5 }, precision: { percent: 0.8, ul: 0.8 } },
                250: { accuracy: { from: 247.0, to: 253.0, percent: 1.2, ul: 3.0 }, precision: { percent: 0.7, ul: 1.75 } },
                500: { accuracy: { from: 495.0, to: 505.0, percent: 1.0, ul: 5.0 }, precision: { percent: 0.6, ul: 3.0 } }
            },
            'P-1000': {
                200: { accuracy: { from: 196.0, to: 204.0, percent: 2.0, ul: 4.0 }, precision: { percent: 1.0, ul: 2.0 } },
                500: { accuracy: { from: 492.0, to: 508.0, percent: 1.6, ul: 8.0 }, precision: { percent: 0.6, ul: 3.0 } },
                1000: { accuracy: { from: 992.0, to: 1008.0, percent: 0.8, ul: 8.0 }, precision: { percent: 0.3, ul: 3.0 } }
            },
            'P-1200': {
                250: { accuracy: { from: 247.0, to: 253.0, percent: 1.2, ul: 3.0 }, precision: { percent: 0.7, ul: 1.75 } },
                600: { accuracy: { from: 594.0, to: 606.0, percent: 1.0, ul: 6.0 }, precision: { percent: 0.5, ul: 3.0 } },
                1200: { accuracy: { from: 1188.0, to: 1212.0, percent: 1.0, ul: 12.0 }, precision: { percent: 0.5, ul: 6.0 } }
            },
            'P-1250': {
                250: { accuracy: { from: 247.0, to: 253.0, percent: 1.2, ul: 3.0 }, precision: { percent: 0.7, ul: 1.75 } },
                625: { accuracy: { from: 618.75, to: 631.25, percent: 1.0, ul: 6.25 }, precision: { percent: 0.5, ul: 3.125 } },
                1250: { accuracy: { from: 1237.5, to: 1262.5, percent: 1.0, ul: 12.5 }, precision: { percent: 0.5, ul: 6.25 } }
            },
            'P-2000': {
                500: { accuracy: { from: 492.0, to: 508.0, percent: 1.6, ul: 8.0 }, precision: { percent: 0.6, ul: 3.0 } },
                1000: { accuracy: { from: 992.0, to: 1008.0, percent: 0.8, ul: 8.0 }, precision: { percent: 0.3, ul: 3.0 } },
                2000: { accuracy: { from: 1984.0, to: 2016.0, percent: 0.8, ul: 16.0 }, precision: { percent: 0.3, ul: 6.0 } }
            },
            'P-5000': {
                1000: { accuracy: { from: 980.0, to: 1020.0, percent: 2.0, ul: 20.0 }, precision: { percent: 0.6, ul: 6.0 } },
                2500: { accuracy: { from: 2475.0, to: 2525.0, percent: 1.0, ul: 25.0 }, precision: { percent: 0.3, ul: 7.5 } },
                5000: { accuracy: { from: 4950.0, to: 5050.0, percent: 1.0, ul: 50.0 }, precision: { percent: 0.3, ul: 15.0 } }
            },
            'P-10000': {
                2000: { accuracy: { from: 1960.0, to: 2040.0, percent: 2.0, ul: 40.0 }, precision: { percent: 0.6, ul: 12.0 } },
                5000: { accuracy: { from: 4950.0, to: 5050.0, percent: 1.0, ul: 50.0 }, precision: { percent: 0.3, ul: 15.0 } },
                10000: { accuracy: { from: 9900.0, to: 10100.0, percent: 1.0, ul: 100.0 }, precision: { percent: 0.3, ul: 30.0 } }
            }
        };

        // Test volumes for each pipette model
        const testVolumes = {
            'P-2': { low: 0.5, mid: 1, high: 2 },
            'P-2.5': { low: 0.5, mid: 1.25, high: 2.5 },
            'P-10': { low: 2, mid: 5, high: 10 },
            'P-20': { low: 5, mid: 10, high: 20 },
            'P-25': { low: 5, mid: 12.5, high: 25 },
            'P-50': { low: 10, mid: 25, high: 50 },
            'P-100': { low: 20, mid: 50, high: 100 },
            'P-200': { low: 50, mid: 100, high: 200 },
            'P-250': { low: 50, mid: 125, high: 250 },
            'P-300': { low: 50, mid: 200, high: 300 },
            'P-500': { low: 100, mid: 250, high: 500 },
            'P-1000': { low: 200, mid: 500, high: 1000 },
            'P-1200': { low: 250, mid: 600, high: 1200 },
            'P-1250': { low: 250, mid: 625, high: 1250 },
            'P-2000': { low: 500, mid: 1000, high: 2000 },
            'P-5000': { low: 1000, mid: 2500, high: 5000 },
            'P-10000': { low: 2000, mid: 5000, high: 10000 }
        };

        // ========================================
        // MODAL FUNCTIONS
        // ========================================

        function showAlert(message, title = 'Notice') {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('modalConfirmBtn').style.display = 'none';
            document.querySelector('.modal-footer .btn-secondary').textContent = 'OK';
            document.getElementById('customModal').style.display = 'flex';
        }

        function showConfirm(message, title = 'Confirm', onConfirm) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('modalConfirmBtn').style.display = 'block';
            document.querySelector('.modal-footer .btn-secondary').textContent = 'Cancel';

            const confirmBtn = document.getElementById('modalConfirmBtn');
            confirmBtn.onclick = () => {
                onConfirm();
                closeModal();
            };

            document.getElementById('customModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('customModal').style.display = 'none';
        }

        // ========================================
        // PASSWORD PROTECTION
        // ========================================

        const CALIBRATION_PASSWORD = 'calintl2024';

        function checkPassword() {
            if (sessionStorage.getItem('basicCalAuth') === 'authenticated') {
                return true;
            }

            const password = prompt('Enter password to access Basic Calibration System:');

            if (password === CALIBRATION_PASSWORD) {
                sessionStorage.setItem('basicCalAuth', 'authenticated');
                return true;
            } else if (password === null) {
                document.body.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100vh; font-family: Arial; font-size: 24px; color: #666;">Access Denied - Password Required</div>';
                return false;
            } else {
                showAlert('Incorrect password. Access denied.', 'Access Denied');
                document.body.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100vh; font-family: Arial; font-size: 24px; color: #666;">Access Denied - Incorrect Password</div>';
                return false;
            }
        }

        function logout() {
            showConfirm("Logout and clear authentication?", "Logout", () => {
                sessionStorage.removeItem('basicCalAuth');
                location.reload();
            });
        }

        // ========================================
        // TAB NAVIGATION
        // ========================================

        function showTab(tabName, tabButton) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all buttons
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            if (tabButton) tabButton.classList.add('active');

            // Update table view if switching to summary
            if (tabName === 'summary') {
                updateSummaryTable();
            }

            // Update report if switching to report
            if (tabName === 'report') {
                generateReport();
            }

            // Initialize labels tab if switching to labels
            if (tabName === 'labels') {
                initLabelsTab();
            }
        }

        // ========================================
        // INVENTORY TRACKING SYSTEM
        // ========================================

        let inventoryUsage = [];

        // Load inventory usage from localStorage
        function loadInventoryUsage() {
            const saved = localStorage.getItem('basicCalInventoryUsage');
            if (saved) {
                try {
                    inventoryUsage = JSON.parse(saved);
                    renderInventoryUsage();
                    updateInventoryStats();
                } catch (e) {
                    console.error('Error loading inventory usage:', e);
                    inventoryUsage = [];
                }
            }
        }

        // Save inventory usage to localStorage
        function saveInventoryUsage() {
            localStorage.setItem('basicCalInventoryUsage', JSON.stringify(inventoryUsage));
        }

        // Open add inventory modal
        function openAddInventoryModal() {
            document.getElementById('addInventoryModal').style.display = 'block';
            // Auto-fill job number if available
            const jobNumber = document.getElementById('customerName')?.value || '';
            if (jobNumber) {
                document.getElementById('invJobNumber').value = jobNumber;
            }
        }

        // Close inventory modal
        function closeInventoryModal() {
            document.getElementById('addInventoryModal').style.display = 'none';
            document.getElementById('addInventoryForm').reset();
        }

        // Add inventory usage
        document.getElementById('addInventoryForm')?.addEventListener('submit', function(e) {
            e.preventDefault();

            const usage = {
                id: Date.now(),
                itemName: document.getElementById('invItemName').value.trim(),
                quantity: parseInt(document.getElementById('invQuantity').value),
                jobNumber: document.getElementById('invJobNumber').value.trim(),
                usedBy: document.getElementById('invUsedBy').value.trim(),
                notes: document.getElementById('invNotes').value.trim(),
                timestamp: new Date().toISOString(),
                sessionId: currentSessionId
            };

            inventoryUsage.push(usage);
            saveInventoryUsage();
            renderInventoryUsage();
            updateInventoryStats();
            closeInventoryModal();

            showAlert(`‚úÖ Added ${usage.quantity} ${usage.itemName}(s) to inventory usage log`, 'Item Added');
        });

        // Render inventory usage table
        function renderInventoryUsage() {
            const tbody = document.getElementById('inventoryUsageBody');
            if (!tbody) return;

            if (inventoryUsage.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="padding: 40px; text-align: center; color: #6c757d;">
                            <div style="font-size: 3rem; opacity: 0.3; margin-bottom: 10px;">üì¶</div>
                            <div>No items used yet. Click "Add Item Used" to log inventory usage.</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = inventoryUsage.map(item => {
                const date = new Date(item.timestamp);
                const timeStr = date.toLocaleString();

                return `
                    <tr style="transition: all 0.3s ease;">
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;"><strong>${item.itemName}</strong></td>
                        <td style="padding: 15px; text-align: center; border-bottom: 1px solid #e5e7eb; font-weight: bold; color: #3b82f6;">${item.quantity}</td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">${item.jobNumber || '-'}</td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">${item.usedBy || '-'}</td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb; font-size: 0.9rem;">${timeStr}</td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb; font-size: 0.9rem;">${item.notes || '-'}</td>
                        <td style="padding: 15px; text-align: center; border-bottom: 1px solid #e5e7eb;">
                            <button onclick="deleteInventoryUsage(${item.id})" class="btn btn-danger btn-small" style="padding: 6px 12px; font-size: 12px;">
                                üóëÔ∏è
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Update inventory stats
        function updateInventoryStats() {
            const totalItems = inventoryUsage.reduce((sum, item) => sum + item.quantity, 0);
            const currentSessionItems = inventoryUsage
                .filter(item => item.sessionId === currentSessionId)
                .reduce((sum, item) => sum + item.quantity, 0);
            const uniqueItems = new Set(inventoryUsage.map(item => item.itemName.toLowerCase())).size;

            document.getElementById('invTotalItems').textContent = totalItems;
            document.getElementById('invCurrentSession').textContent = currentSessionItems;
            document.getElementById('invUniqueItems').textContent = uniqueItems;
        }

        // Delete inventory usage
        function deleteInventoryUsage(id) {
            if (confirm('Are you sure you want to delete this inventory usage record?')) {
                inventoryUsage = inventoryUsage.filter(item => item.id !== id);
                saveInventoryUsage();
                renderInventoryUsage();
                updateInventoryStats();
                showAlert('Inventory usage record deleted', 'Deleted');
            }
        }

        // Clear all inventory usage
        function clearInventoryUsage() {
            showConfirm('Are you sure you want to clear ALL inventory usage records? This cannot be undone.', 'Clear All', () => {
                inventoryUsage = [];
                saveInventoryUsage();
                renderInventoryUsage();
                updateInventoryStats();
                showAlert('All inventory usage records cleared', 'Cleared');
            });
        }

        // Export inventory usage
        function exportInventoryUsage() {
            if (inventoryUsage.length === 0) {
                showAlert('No inventory usage data to export', 'No Data');
                return;
            }

            const html = `
<!DOCTYPE html>
<html>
<head>
    <title>Inventory Usage Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8fafc; }
        .header { text-align: center; margin-bottom: 30px; padding: 30px; background: white; border-radius: 12px; }
        .logo { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 15px 20px; border-radius: 8px; font-weight: bold; display: inline-block; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; }
        th { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); padding: 15px; text-align: left; font-weight: 700; border-bottom: 2px solid #e5e7eb; }
        td { padding: 12px 15px; border-bottom: 1px solid #e5e7eb; }
        tr:hover { background: #f8fafc; }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px; }
        .stat-box { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .stat-number { font-size: 2rem; font-weight: bold; color: #3b82f6; }
        .stat-label { color: #6b7280; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">CALIBRATIONS INTERNATIONAL INC.</div>
        <h1>Inventory Usage Report</h1>
        <p><strong>Generated:</strong> ${new Date().toLocaleString()}</p>
        <p><strong>Total Records:</strong> ${inventoryUsage.length}</p>
    </div>

    <div class="stats">
        <div class="stat-box">
            <div class="stat-number">${inventoryUsage.reduce((sum, item) => sum + item.quantity, 0)}</div>
            <div class="stat-label">Total Items Used</div>
        </div>
        <div class="stat-box">
            <div class="stat-number">${inventoryUsage.length}</div>
            <div class="stat-label">Usage Records</div>
        </div>
        <div class="stat-box">
            <div class="stat-number">${new Set(inventoryUsage.map(item => item.itemName.toLowerCase())).size}</div>
            <div class="stat-label">Unique Items</div>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Item Name</th>
                <th>Quantity</th>
                <th>Job/Invoice</th>
                <th>Used By</th>
                <th>Date/Time</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            ${inventoryUsage.map(item => `
                <tr>
                    <td><strong>${item.itemName}</strong></td>
                    <td style="text-align: center; font-weight: bold; color: #3b82f6;">${item.quantity}</td>
                    <td>${item.jobNumber || '-'}</td>
                    <td>${item.usedBy || '-'}</td>
                    <td>${new Date(item.timestamp).toLocaleString()}</td>
                    <td>${item.notes || '-'}</td>
                </tr>
            `).join('')}
        </tbody>
    </table>

    <div style="margin-top: 40px; text-align: center; font-size: 0.8rem; color: #6b7280;">
        This report was automatically generated by Basic Calibration Service - Calibrations International Inc.
    </div>
</body>
</html>
            `;

            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `inventory_usage_report_${new Date().toISOString().split('T')[0]}.html`;
            link.click();
            URL.revokeObjectURL(url);

            showAlert('üìÑ Inventory usage report exported successfully!', 'Export Complete');
        }

        // ========================================
        // UNDO/REDO SYSTEM
        // ========================================

        function saveStateForUndo(actionDescription) {
            const state = {
                pipettes: JSON.parse(JSON.stringify(pipettes)),
                currentPipetteId: currentPipetteId,
                sessionInfo: getSessionInfo(),
                action: actionDescription,
                timestamp: Date.now()
            };

            undoStack.push(state);

            if (undoStack.length > MAX_HISTORY) {
                undoStack.shift();
            }

            redoStack = [];
            updateUndoRedoButtons();
        }

        function undo() {
            if (undoStack.length === 0) return;

            const currentState = {
                pipettes: JSON.parse(JSON.stringify(pipettes)),
                currentPipetteId: currentPipetteId,
                sessionInfo: getSessionInfo(),
                timestamp: Date.now()
            };
            redoStack.push(currentState);

            const previousState = undoStack.pop();
            pipettes = previousState.pipettes;
            currentPipetteId = previousState.currentPipetteId;

            Object.keys(previousState.sessionInfo).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = previousState.sessionInfo[key] || '';
                }
            });

            renderAllPipettes();
            updateProgress();
            autoSave();
            updateUndoRedoButtons();
        }

        function redo() {
            if (redoStack.length === 0) return;

            const currentState = {
                pipettes: JSON.parse(JSON.stringify(pipettes)),
                currentPipetteId: currentPipetteId,
                sessionInfo: getSessionInfo(),
                action: 'Redo',
                timestamp: Date.now()
            };
            undoStack.push(currentState);

            const nextState = redoStack.pop();
            pipettes = nextState.pipettes;
            currentPipetteId = nextState.currentPipetteId;

            Object.keys(nextState.sessionInfo).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = nextState.sessionInfo[key] || '';
                }
            });

            renderAllPipettes();
            updateProgress();
            autoSave();
            updateUndoRedoButtons();
        }

        function updateUndoRedoButtons() {
            const undoBtn = document.getElementById('undoBtn');
            const redoBtn = document.getElementById('redoBtn');

            if (undoBtn) {
                undoBtn.disabled = undoStack.length === 0;
                undoBtn.title = undoStack.length > 0 ? `Undo: ${undoStack[undoStack.length - 1].action}` : 'Nothing to undo';
            }

            if (redoBtn) {
                redoBtn.disabled = redoStack.length === 0;
                redoBtn.title = redoStack.length > 0 ? 'Redo last action' : 'Nothing to redo';
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
                e.preventDefault();
                undo();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 'z' && e.shiftKey) {
                e.preventDefault();
                redo();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 'y') {
                e.preventDefault();
                redo();
            }
        });

        // ========================================
        // AUTOSAVE SYSTEM
        // ========================================

        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function autoSave() {
            if (!currentSessionId) {
                currentSessionId = generateSessionId();
            }

            const sessionData = {
                id: currentSessionId,
                sessionInfo: getSessionInfo(),
                pipettes: pipettes,
                currentPipetteId: currentPipetteId,
                timestamp: new Date().toISOString(),
                lastModified: new Date().toISOString()
            };

            try {
                localStorage.setItem('currentBasicSession', JSON.stringify(sessionData));

                let sessions = JSON.parse(localStorage.getItem('basicCalSessions') || '[]');
                const existingIndex = sessions.findIndex(s => s.id === currentSessionId);

                if (existingIndex >= 0) {
                    sessions[existingIndex] = sessionData;
                } else {
                    sessions.unshift(sessionData);
                }

                if (sessions.length > 50) {
                    sessions = sessions.slice(0, 50);
                }

                localStorage.setItem('basicCalSessions', JSON.stringify(sessions));
                showSaveIndicator();
            } catch (error) {
                if (error.name === 'QuotaExceededError') {
                    showAlert('Storage quota exceeded! Please download a backup.', 'Storage Warning');
                } else {
                    console.error('Error saving session:', error);
                }
            }
        }

        function debouncedAutoSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                autoSave();
            }, 500);
        }

        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        function loadCurrentSession() {
            const savedSession = localStorage.getItem('currentBasicSession');
            if (!savedSession) return false;

            try {
                const sessionData = JSON.parse(savedSession);
                currentSessionId = sessionData.id;
                pipettes = sessionData.pipettes || [];
                currentPipetteId = sessionData.currentPipetteId || 0;

                // Backward compatibility: convert old manufacturer/model to makeModel
                pipettes.forEach(pipette => {
                    if (pipette.manufacturer || pipette.model) {
                        // Combine manufacturer and model if they exist
                        const parts = [];
                        if (pipette.manufacturer) parts.push(pipette.manufacturer);
                        if (pipette.model) parts.push(pipette.model);
                        pipette.makeModel = parts.join(' ');

                        // Remove old fields
                        delete pipette.manufacturer;
                        delete pipette.model;
                    }
                    // Ensure makeModel exists
                    if (!pipette.makeModel) {
                        pipette.makeModel = '';
                    }
                });

                const sessionInfo = sessionData.sessionInfo || {};
                Object.keys(sessionInfo).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = sessionInfo[key] || '';
                    }
                });

                renderAllPipettes();
                updateProgress();
                loadInventoryUsage(); // Load inventory usage data
                return true;
            } catch (error) {
                console.error('Error loading session:', error);
                return false;
            }
        }

        // Save before window closes
        window.addEventListener('beforeunload', (e) => {
            if (pipettes.length > 0) {
                autoSave();
            }
        });

        // ========================================
        // BACKUP REMINDER SYSTEM
        // ========================================

        function checkBackupReminder() {
            const BACKUP_REMINDER_DAYS = 7;
            const DISMISS_DURATION_MS = 24 * 60 * 60 * 1000; // 24 hours

            const lastBackup = localStorage.getItem('lastBackupDate');
            const dismissedUntil = localStorage.getItem('backupReminderDismissedUntil');

            // Check if reminder is currently dismissed
            if (dismissedUntil && Date.now() < parseInt(dismissedUntil)) {
                return; // Don't show reminder yet
            }

            // Check if backup is needed
            const now = Date.now();
            const daysSinceBackup = lastBackup ? (now - parseInt(lastBackup)) / (1000 * 60 * 60 * 24) : 999;

            if (daysSinceBackup > BACKUP_REMINDER_DAYS) {
                showBackupReminder();
            }
        }

        function showBackupReminder() {
            // Remove any existing reminder
            const existing = document.getElementById('backupReminder');
            if (existing) existing.remove();

            const banner = document.createElement('div');
            banner.id = 'backupReminder';
            banner.style.cssText = `
                position: fixed;
                top: 70px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
                color: #2d3436;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 9999;
                display: flex;
                align-items: center;
                gap: 15px;
                max-width: 600px;
                animation: slideDown 0.3s ease;
                font-size: 14px;
                font-weight: 500;
            `;

            banner.innerHTML = `
                <span style="font-size: 24px;">‚ö†Ô∏è</span>
                <div style="flex: 1;">
                    <strong>Backup Reminder:</strong> It's been over 7 days since your last backup.
                    <br><small>Download your data to prevent loss.</small>
                </div>
                <button onclick="downloadBackupAndDismiss()" class="btn btn-primary" style="padding: 8px 16px; font-size: 13px;">
                    üì• Download Backup
                </button>
                <button onclick="dismissBackupReminder()" class="btn btn-secondary" style="padding: 8px 16px; font-size: 13px;">
                    Dismiss 24h
                </button>
                <button onclick="closeBackupReminder()" style="padding: 4px 8px; background: transparent; border: none; cursor: pointer; font-size: 18px;">
                    ‚úï
                </button>
            `;

            document.body.appendChild(banner);
        }

        function downloadBackupAndDismiss() {
            saveSession(); // Trigger download
            closeBackupReminder();
        }

        function dismissBackupReminder() {
            const dismissUntil = Date.now() + (24 * 60 * 60 * 1000); // 24 hours from now
            localStorage.setItem('backupReminderDismissedUntil', dismissUntil.toString());
            closeBackupReminder();
        }

        function closeBackupReminder() {
            const banner = document.getElementById('backupReminder');
            if (banner) {
                banner.remove();
            }
        }

        // ========================================
        // AUTOFILL SYSTEM FOR COMMON VALUES
        // ========================================

        function saveRecentValue(fieldName, value) {
            if (!value || value.trim() === '') return;

            const recentValues = JSON.parse(localStorage.getItem('recentBasicCalValues') || '{}');

            if (!recentValues[fieldName]) {
                recentValues[fieldName] = [];
            }

            // Remove duplicate if exists
            recentValues[fieldName] = recentValues[fieldName].filter(v => v !== value);

            // Add to front
            recentValues[fieldName].unshift(value);

            // Keep only last 5 unique values
            recentValues[fieldName] = recentValues[fieldName].slice(0, 5);

            localStorage.setItem('recentBasicCalValues', JSON.stringify(recentValues));
        }

        function getRecentValues(fieldName) {
            const recentValues = JSON.parse(localStorage.getItem('recentBasicCalValues') || '{}');
            return recentValues[fieldName] || [];
        }

        function setupAutofill() {
            const autofillFields = ['technician', 'pi', 'contact', 'company'];

            autofillFields.forEach(fieldName => {
                const input = document.getElementById(fieldName);
                if (!input) return;

                // Create datalist if doesn't exist
                let datalist = document.getElementById(`${fieldName}List`);
                if (!datalist) {
                    datalist = document.createElement('datalist');
                    datalist.id = `${fieldName}List`;
                    input.setAttribute('list', `${fieldName}List`);
                    input.parentNode.appendChild(datalist);
                }

                // Populate datalist with recent values
                const recentValues = getRecentValues(fieldName);
                datalist.innerHTML = recentValues.map(value =>
                    `<option value="${value}">`
                ).join('');

                // Save value when changed
                input.addEventListener('change', () => {
                    saveRecentValue(fieldName, input.value);
                    // Update datalist
                    const updated = getRecentValues(fieldName);
                    datalist.innerHTML = updated.map(value =>
                        `<option value="${value}">`
                    ).join('');
                });
            });

        }

        // ========================================
        // PIPETTE MANAGEMENT
        // ========================================

        function addPipette() {
            saveStateForUndo('Add pipette');
            currentPipetteId++;

            const pipette = {
                id: currentPipetteId,
                number: String(currentPipetteId).padStart(2, '0'),
                serialNumber: '',
                makeModel: '',  // Combined make/model dropdown
                maxVolume: '',
                inSpec: false,
                outSpec: false,
                adjustments: {
                    SE: '',     // Seal type (dropdown)
                    COR: '',    // Corrosion (dropdown)
                    G: '',      // Grease (dropdown)
                    SH: '',     // Shaft (dropdown)
                    FR: '',     // Friction Ring (dropdown)
                    O: '',      // O Ring (dropdown)
                    OTHER: ''   // Other text field
                },
                finalVolumes: ['', '', '', ''],
                passFail: '',
                comments: ''
            };

            pipettes.push(pipette);
            renderPipette(pipette);
            updateProgress();
            updateEmptyState();
            debouncedAutoSave();
        }

        function copyFromPrevious() {
            if (pipettes.length === 0) {
                showAlert('No pipettes to copy from. Add a pipette first.', 'Info');
                return;
            }

            saveStateForUndo('Copy from previous');
            currentPipetteId++;

            // Get the last pipette
            const lastPipette = pipettes[pipettes.length - 1];

            // Create new pipette with copied configuration
            const pipette = {
                id: currentPipetteId,
                number: String(currentPipetteId).padStart(2, '0'),
                serialNumber: '',  // Clear serial number
                makeModel: lastPipette.makeModel,  // Copy make/model
                maxVolume: lastPipette.maxVolume,  // Copy max volume
                inSpec: lastPipette.inSpec,  // Copy in-spec checkbox
                outSpec: lastPipette.outSpec,  // Copy out-spec checkbox
                adjustments: {
                    SE: lastPipette.adjustments.SE,
                    COR: lastPipette.adjustments.COR,
                    G: lastPipette.adjustments.G,
                    SH: lastPipette.adjustments.SH,
                    FR: lastPipette.adjustments.FR,
                    O: lastPipette.adjustments.O,
                    OTHER: lastPipette.adjustments.OTHER
                },
                finalVolumes: ['', '', '', ''],  // Clear volumes
                passFail: '',  // Clear pass/fail
                comments: ''  // Clear comments
            };

            pipettes.push(pipette);
            renderPipette(pipette);
            updateProgress();
            updateEmptyState();
            debouncedAutoSave();

            // Scroll to new pipette
            setTimeout(() => {
                const newCard = document.querySelector(`[data-pipette-id="${pipette.id}"]`);
                if (newCard) {
                    newCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }, 100);
        }

        // ========================================
        // BULK ACTIONS
        // ========================================

        function updateBulkButtons() {
            const checkboxes = document.querySelectorAll('.pipette-checkbox');
            const checkedBoxes = Array.from(checkboxes).filter(cb => cb.checked);
            const bulkBar = document.getElementById('bulkActionsBar');
            const selectedCount = document.getElementById('selectedCount');
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');

            // Show/hide bulk actions bar
            if (pipettes.length > 0) {
                bulkBar.style.display = 'block';
            } else {
                bulkBar.style.display = 'none';
            }

            // Update count
            selectedCount.textContent = `${checkedBoxes.length} selected`;

            // Update select all checkbox state
            if (selectAllCheckbox) {
                if (checkedBoxes.length === 0) {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = false;
                } else if (checkedBoxes.length === checkboxes.length) {
                    selectAllCheckbox.checked = true;
                    selectAllCheckbox.indeterminate = false;
                } else {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = true;
                }
            }
        }

        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAllCheckbox').checked;
            const checkboxes = document.querySelectorAll('.pipette-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = selectAll;
            });
            updateBulkButtons();
        }

        function bulkMarkStatus(status) {
            const checkboxes = document.querySelectorAll('.pipette-checkbox:checked');
            if (checkboxes.length === 0) {
                showAlert('Please select at least one pipette.', 'Info');
                return;
            }

            saveStateForUndo(`Bulk mark ${status}`);

            checkboxes.forEach(checkbox => {
                const pipetteId = parseInt(checkbox.id.replace('checkbox-', ''));
                const pipette = pipettes.find(p => p.id === pipetteId);
                if (pipette) {
                    pipette.passFail = status;
                    // Update UI
                    const passFailField = document.getElementById(`passfail-${pipetteId}`);
                    if (passFailField) {
                        passFailField.value = status;
                    }
                }
            });

            // Uncheck all checkboxes
            checkboxes.forEach(cb => cb.checked = false);
            updateBulkButtons();

            // Re-render all pipettes to update status badges
            renderAllPipettes();
            debouncedAutoSave();

            showAlert(`${checkboxes.length} pipette(s) marked as ${status}`, 'Success');
        }

        // ========================================
        // VOICE INPUT FOR READINGS
        // ========================================

        let voiceRecognition = null;
        let currentVoicePipetteId = null;
        let currentReadingIndex = 0;
        let voiceSupported = false;

        // Check if browser supports speech recognition
        function checkVoiceSupport() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            voiceSupported = !!SpeechRecognition;

            if (!voiceSupported) {
                console.warn('Speech Recognition not supported in this browser');
            }

            return voiceSupported;
        }

        // Initialize speech recognition
        function initVoiceRecognition() {
            if (!checkVoiceSupport()) {
                return null;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();

            recognition.continuous = true;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
            recognition.maxAlternatives = 1;

            recognition.onresult = (event) => {
                const lastResult = event.results[event.results.length - 1];
                if (lastResult.isFinal) {
                    const transcript = lastResult[0].transcript.trim();
                    handleVoiceResult(transcript);
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                const statusEl = document.getElementById(`voice-status-${currentVoicePipetteId}`);

                if (event.error === 'not-allowed' || event.error === 'service-not-allowed') {
                    updateVoiceStatus('‚ùå Microphone access denied', true);
                    stopVoiceInput();
                } else if (event.error === 'no-speech') {
                    updateVoiceStatus('‚è±Ô∏è No speech detected. Try again.', true);
                } else if (event.error === 'network') {
                    updateVoiceStatus('üì° Network error. Check connection.', true);
                    stopVoiceInput();
                } else {
                    updateVoiceStatus(`‚ùå Error: ${event.error}`, true);
                }
            };

            recognition.onend = () => {
                // If we're still in voice mode, restart recognition
                if (currentVoicePipetteId && currentReadingIndex < 4) {
                    try {
                        recognition.start();
                    } catch (e) {
                        console.error('Failed to restart recognition:', e);
                        stopVoiceInput();
                    }
                }
            };

            return recognition;
        }

        // Parse spoken number to float
        function parseSpokenNumber(transcript) {
            // Clean up transcript
            let text = transcript.toLowerCase()
                .replace(/point/g, '.')
                .replace(/decimal/g, '.')
                .trim();

            // Try to parse as a direct number first
            let number = parseFloat(text);
            if (!isNaN(number)) {
                return number;
            }

            // Handle word numbers (basic support)
            const wordNumbers = {
                'zero': 0, 'one': 1, 'two': 2, 'three': 3, 'four': 4,
                'five': 5, 'six': 6, 'seven': 7, 'eight': 8, 'nine': 9,
                'ten': 10, 'eleven': 11, 'twelve': 12, 'thirteen': 13,
                'fourteen': 14, 'fifteen': 15, 'sixteen': 16, 'seventeen': 17,
                'eighteen': 18, 'nineteen': 19, 'twenty': 20, 'thirty': 30,
                'forty': 40, 'fifty': 50, 'sixty': 60, 'seventy': 70,
                'eighty': 80, 'ninety': 90, 'hundred': 100, 'thousand': 1000
            };

            // Simple word-to-number conversion
            for (const [word, value] of Object.entries(wordNumbers)) {
                text = text.replace(new RegExp(word, 'g'), value.toString());
            }

            // Try parsing again
            number = parseFloat(text);
            if (!isNaN(number) && number >= 0 && number <= 100000) {
                return number;
            }

            return null;
        }

        // Update voice status message
        function updateVoiceStatus(message, isError = false) {
            if (!currentVoicePipetteId) return;

            const statusEl = document.getElementById(`voice-status-${currentVoicePipetteId}`);
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.className = isError ? 'voice-status error' : 'voice-status';
            }
        }

        // Handle voice recognition result
        function handleVoiceResult(transcript) {
            if (!currentVoicePipetteId || currentReadingIndex >= 4) {
                stopVoiceInput();
                return;
            }

            const lowerTranscript = transcript.toLowerCase().trim();

            // Check for voice commands first (commands take priority over numbers)
            if (executeVoiceCommand(lowerTranscript, currentVoicePipetteId)) {
                return; // Command was executed
            }

            // Try to parse as number
            const number = parseSpokenNumber(transcript);

            if (number === null) {
                updateVoiceStatus(`‚ùì Didn't understand "${transcript}". Try again or say "help"`, true);
                return;
            }

            // Round to 3 decimal places
            const roundedNumber = Math.round(number * 1000) / 1000;

            // Update the field
            updateFinalVolume(currentVoicePipetteId, currentReadingIndex, roundedNumber.toString());

            // Update UI
            const inputField = document.getElementById(`vol${currentReadingIndex + 1}-${currentVoicePipetteId}`);
            if (inputField) {
                inputField.value = roundedNumber;
                inputField.classList.remove('voice-active');
            }

            updateVoiceStatus(`‚úì Heard: ${roundedNumber} ¬µL`, false);

            // Move to next reading
            currentReadingIndex++;

            if (currentReadingIndex >= 4) {
                // All readings captured
                setTimeout(() => {
                    updateVoiceStatus('‚úÖ All readings captured!', false);
                    stopVoiceInput();
                }, 500);
            } else {
                // Highlight next reading
                setTimeout(() => {
                    const nextField = document.getElementById(`vol${currentReadingIndex + 1}-${currentVoicePipetteId}`);
                    if (nextField) {
                        nextField.classList.add('voice-active');
                    }
                    updateVoiceStatus(`üé§ Listening for Reading ${currentReadingIndex + 1}...`, false);
                }, 600);
            }
        }

        // Execute voice command
        function executeVoiceCommand(transcript, pipetteId) {
            // Help command
            if (transcript.includes('help') || transcript.includes('commands')) {
                updateVoiceStatus(`üìã Commands: "next", "previous", "mark pass", "mark fail", "repeat", "add pipette"`, false);
                return true;
            }

            // Stop/cancel
            if (transcript.includes('stop') || transcript.includes('cancel') || transcript.includes('quit')) {
                updateVoiceStatus('‚èπÔ∏è Stopped listening', false);
                stopVoiceInput();
                return true;
            }

            // Repeat last reading
            if (transcript.includes('repeat') || transcript.includes('redo') || transcript.includes('again')) {
                if (currentReadingIndex > 0) {
                    currentReadingIndex--;
                    const field = document.getElementById(`vol${currentReadingIndex + 1}-${pipetteId}`);
                    if (field) {
                        field.value = '';
                        field.classList.add('voice-active');
                        // Clear previous field highlight
                        for (let i = 1; i <= 4; i++) {
                            if (i !== currentReadingIndex + 1) {
                                document.getElementById(`vol${i}-${pipetteId}`)?.classList.remove('voice-active');
                            }
                        }
                    }
                    updateVoiceStatus(`üîÑ Ready to re-enter Reading ${currentReadingIndex + 1}`, false);
                } else {
                    updateVoiceStatus('‚ö†Ô∏è No reading to repeat yet', true);
                }
                return true;
            }

            // Mark as PASS
            if (transcript.includes('mark pass') || transcript.includes('passed') || transcript.includes('mark as pass')) {
                updatePipetteField(pipetteId, 'passFail', 'P');
                const selectField = document.getElementById(`pf-${pipetteId}`);
                if (selectField) selectField.value = 'P';
                updateVoiceStatus('‚úÖ Marked as PASS', false);
                renderAllPipettes();
                return true;
            }

            // Mark as FAIL
            if (transcript.includes('mark fail') || transcript.includes('failed') || transcript.includes('mark as fail')) {
                updatePipetteField(pipetteId, 'passFail', 'F');
                const selectField = document.getElementById(`pf-${pipetteId}`);
                if (selectField) selectField.value = 'F';
                updateVoiceStatus('‚ùå Marked as FAIL', false);
                renderAllPipettes();
                return true;
            }

            // Navigate to next pipette
            if (transcript.includes('next') && (transcript.includes('pipette') || transcript.length < 8)) {
                const currentIdx = pipettes.findIndex(p => p.id === pipetteId);
                if (currentIdx < pipettes.length - 1) {
                    const nextPipette = pipettes[currentIdx + 1];
                    stopVoiceInput();
                    setTimeout(() => {
                        const nextCard = document.getElementById(`pipette-${nextPipette.id}`);
                        if (nextCard) {
                            nextCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                        updateVoiceStatus('‚û°Ô∏è Moved to next pipette', false);
                    }, 300);
                } else {
                    updateVoiceStatus('‚ö†Ô∏è This is the last pipette', true);
                }
                return true;
            }

            // Navigate to previous pipette
            if ((transcript.includes('previous') || transcript.includes('back')) && (transcript.includes('pipette') || transcript.length < 10)) {
                const currentIdx = pipettes.findIndex(p => p.id === pipetteId);
                if (currentIdx > 0) {
                    const prevPipette = pipettes[currentIdx - 1];
                    stopVoiceInput();
                    setTimeout(() => {
                        const prevCard = document.getElementById(`pipette-${prevPipette.id}`);
                        if (prevCard) {
                            prevCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                        updateVoiceStatus('‚¨ÖÔ∏è Moved to previous pipette', false);
                    }, 300);
                } else {
                    updateVoiceStatus('‚ö†Ô∏è This is the first pipette', true);
                }
                return true;
            }

            // Add new pipette
            if (transcript.includes('add pipette') || transcript.includes('new pipette')) {
                stopVoiceInput();
                addPipette();
                updateVoiceStatus('‚ûï New pipette added', false);
                return true;
            }

            return false; // No command matched
        }

        // Start voice input
        function startVoiceInput(pipetteId) {
            if (!checkVoiceSupport()) {
                showAlert('Voice input is not supported in your browser. Please use Chrome, Edge, or Safari.', 'Info');
                return;
            }

            currentVoicePipetteId = pipetteId;
            currentReadingIndex = 0;

            // Initialize recognition if needed
            if (!voiceRecognition) {
                voiceRecognition = initVoiceRecognition();
            }

            try {
                voiceRecognition.start();

                // Update button state
                const button = document.getElementById(`voice-btn-${pipetteId}`);
                if (button) {
                    button.classList.add('listening');
                    button.innerHTML = '‚èπÔ∏è Stop';
                }

                // Highlight first reading field
                const firstField = document.getElementById(`vol1-${pipetteId}`);
                if (firstField) {
                    firstField.classList.add('voice-active');
                }

                updateVoiceStatus('üé§ Listening for Reading 1... (Say "help" for commands)', false);
            } catch (error) {
                console.error('Failed to start voice recognition:', error);
                showAlert('Failed to start voice input. Please check microphone permissions.', 'Error');
                stopVoiceInput();
            }
        }

        // Stop voice input
        function stopVoiceInput() {
            if (voiceRecognition) {
                try {
                    voiceRecognition.stop();
                } catch (e) {
                    console.error('Error stopping recognition:', e);
                }
            }

            if (currentVoicePipetteId) {
                // Update button state
                const button = document.getElementById(`voice-btn-${currentVoicePipetteId}`);
                if (button) {
                    button.classList.remove('listening');
                    button.innerHTML = 'üé§ Voice Input';
                }

                // Remove voice-active class from all fields
                for (let i = 1; i <= 4; i++) {
                    const field = document.getElementById(`vol${i}-${currentVoicePipetteId}`);
                    if (field) {
                        field.classList.remove('voice-active');
                    }
                }

                // Clear status after a delay if not error
                const statusEl = document.getElementById(`voice-status-${currentVoicePipetteId}`);
                if (statusEl && !statusEl.classList.contains('error')) {
                    setTimeout(() => {
                        statusEl.textContent = '';
                    }, 3000);
                }
            }

            currentVoicePipetteId = null;
            currentReadingIndex = 0;
        }

        // Toggle voice input on/off
        function toggleVoiceInput(pipetteId) {
            if (currentVoicePipetteId === pipetteId) {
                stopVoiceInput();
            } else {
                if (currentVoicePipetteId) {
                    stopVoiceInput();
                }
                startVoiceInput(pipetteId);
            }
        }

        function getPipetteBanner(pipette) {
            const serial = pipette.serialNumber || '';
            const makeModel = pipette.makeModel || '';

            if (serial && makeModel) {
                return `${serial} - ${makeModel}`;
            } else if (serial) {
                return serial;
            } else if (makeModel) {
                return makeModel;
            } else {
                return 'New Pipette';
            }
        }

        function generateMakeModelOptions(selectedValue) {
            const isSelected = (val) => selectedValue === val ? 'selected' : '';

            return `
                <option value=""></option>
                <optgroup label="‚îÄ‚îÄ Eppendorf ‚îÄ‚îÄ">
                    <option value="Epp Handy Step" ${isSelected('Epp Handy Step')}>Epp Handy Step</option>
                    <option value="Epp Repeater" ${isSelected('Epp Repeater')}>Epp Repeater</option>
                    <option value="Epp Research" ${isSelected('Epp Research')}>Epp Research</option>
                    <option value="Epp Research Plus" ${isSelected('Epp Research Plus')}>Epp Research Plus</option>
                    <option value="Epp Xplorer plus" ${isSelected('Epp Xplorer plus')}>Epp Xplorer plus</option>
                    <option value="Eppendorf 4700" ${isSelected('Eppendorf 4700')}>Eppendorf 4700</option>
                    <option value="Eppendorf 4710" ${isSelected('Eppendorf 4710')}>Eppendorf 4710</option>
                    <option value="Eppendorf Black" ${isSelected('Eppendorf Black')}>Eppendorf Black</option>
                    <option value="Eppendorf brown" ${isSelected('Eppendorf brown')}>Eppendorf brown</option>
                    <option value="Eppendorf Reference" ${isSelected('Eppendorf Reference')}>Eppendorf Reference</option>
                    <option value="Eppendorf Reference 2" ${isSelected('Eppendorf Reference 2')}>Eppendorf Reference 2</option>
                    <option value="Eppendorf Repeater E3" ${isSelected('Eppendorf Repeater E3')}>Eppendorf Repeater E3</option>
                    <option value="Eppendorf Repeater M4" ${isSelected('Eppendorf Repeater M4')}>Eppendorf Repeater M4</option>
                    <option value="Eppendorf Xplorer" ${isSelected('Eppendorf Xplorer')}>Eppendorf Xplorer</option>
                </optgroup>
                <optgroup label="‚îÄ‚îÄ Rainin ‚îÄ‚îÄ">
                    <option value="Rainin AutoRep E" ${isSelected('Rainin AutoRep E')}>Rainin AutoRep E</option>
                    <option value="Rainin Classic" ${isSelected('Rainin Classic')}>Rainin Classic</option>
                    <option value="Rainin EDP3" ${isSelected('Rainin EDP3')}>Rainin EDP3</option>
                    <option value="Rainin NanoRep" ${isSelected('Rainin NanoRep')}>Rainin NanoRep</option>
                    <option value="Rainin Pipete Plus SL" ${isSelected('Rainin Pipete Plus SL')}>Rainin Pipete Plus SL</option>
                    <option value="Rainin Pipete XLS SL" ${isSelected('Rainin Pipete XLS SL')}>Rainin Pipete XLS SL</option>
                    <option value="Rainin Pipette Lite" ${isSelected('Rainin Pipette Lite')}>Rainin Pipette Lite</option>
                    <option value="Rainin Pipette Lite E4" ${isSelected('Rainin Pipette Lite E4')}>Rainin Pipette Lite E4</option>
                    <option value="Rainin Pipette Lite SL" ${isSelected('Rainin Pipette Lite SL')}>Rainin Pipette Lite SL</option>
                    <option value="Rainin Pipette Lite XLS" ${isSelected('Rainin Pipette Lite XLS')}>Rainin Pipette Lite XLS</option>
                    <option value="Rainin Pipette Lite XLS E4" ${isSelected('Rainin Pipette Lite XLS E4')}>Rainin Pipette Lite XLS E4</option>
                    <option value="Rainin Pipette Plus" ${isSelected('Rainin Pipette Plus')}>Rainin Pipette Plus</option>
                </optgroup>
                <optgroup label="‚îÄ‚îÄ Gilson ‚îÄ‚îÄ">
                    <option value="Gilson" ${isSelected('Gilson')}>Gilson</option>
                    <option value="Gilson Microman" ${isSelected('Gilson Microman')}>Gilson Microman</option>
                    <option value="Gilson Neo" ${isSelected('Gilson Neo')}>Gilson Neo</option>
                    <option value="Gilson Pipetman" ${isSelected('Gilson Pipetman')}>Gilson Pipetman</option>
                    <option value="Gilson Ultra" ${isSelected('Gilson Ultra')}>Gilson Ultra</option>
                </optgroup>
                <optgroup label="‚îÄ‚îÄ Finn / Thermo ‚îÄ‚îÄ">
                    <option value="Finn" ${isSelected('Finn')}>Finn</option>
                    <option value="Finn Clip tip" ${isSelected('Finn Clip tip')}>Finn Clip tip</option>
                    <option value="Finn Colours" ${isSelected('Finn Colours')}>Finn Colours</option>
                    <option value="Finn Digital" ${isSelected('Finn Digital')}>Finn Digital</option>
                    <option value="Finn F1" ${isSelected('Finn F1')}>Finn F1</option>
                    <option value="Finn Focus" ${isSelected('Finn Focus')}>Finn Focus</option>
                    <option value="Finn II" ${isSelected('Finn II')}>Finn II</option>
                    <option value="Finn Labsystem Repeater" ${isSelected('Finn Labsystem Repeater')}>Finn Labsystem Repeater</option>
                    <option value="Finnpipette" ${isSelected('Finnpipette')}>Finnpipette</option>
                    <option value="Finnpipette II" ${isSelected('Finnpipette II')}>Finnpipette II</option>
                    <option value="Fisher elite Finn F1" ${isSelected('Fisher elite Finn F1')}>Fisher elite Finn F1</option>
                    <option value="Fisher elite Finn F2" ${isSelected('Fisher elite Finn F2')}>Fisher elite Finn F2</option>
                    <option value="Fisher Finn" ${isSelected('Fisher Finn')}>Fisher Finn</option>
                    <option value="Fisherbrand" ${isSelected('Fisherbrand')}>Fisherbrand</option>
                    <option value="Fisherbrand HandyStep S" ${isSelected('Fisherbrand HandyStep S')}>Fisherbrand HandyStep S</option>
                    <option value="Fisherbrand Repeater" ${isSelected('Fisherbrand Repeater')}>Fisherbrand Repeater</option>
                    <option value="Thermo Scientific Matrix" ${isSelected('Thermo Scientific Matrix')}>Thermo Scientific Matrix</option>
                    <option value="Thermo Scientific S1" ${isSelected('Thermo Scientific S1')}>Thermo Scientific S1</option>
                </optgroup>
                <optgroup label="‚îÄ‚îÄ VWR ‚îÄ‚îÄ">
                    <option value="VWR" ${isSelected('VWR')}>VWR</option>
                    <option value="VWR Blue" ${isSelected('VWR Blue')}>VWR Blue</option>
                    <option value="VWR Electronic" ${isSelected('VWR Electronic')}>VWR Electronic</option>
                    <option value="VWR Ergonomic" ${isSelected('VWR Ergonomic')}>VWR Ergonomic</option>
                    <option value="VWR Ergonomic HP" ${isSelected('VWR Ergonomic HP')}>VWR Ergonomic HP</option>
                    <option value="VWR Labpette" ${isSelected('VWR Labpette')}>VWR Labpette</option>
                    <option value="VWR LTS Comp" ${isSelected('VWR LTS Comp')}>VWR LTS Comp</option>
                    <option value="VWR Sealpette" ${isSelected('VWR Sealpette')}>VWR Sealpette</option>
                    <option value="VWR Ultra" ${isSelected('VWR Ultra')}>VWR Ultra</option>
                </optgroup>
                <optgroup label="‚îÄ‚îÄ Biohit ‚îÄ‚îÄ">
                    <option value="Biohit eline" ${isSelected('Biohit eline')}>Biohit eline</option>
                    <option value="Biohit mline" ${isSelected('Biohit mline')}>Biohit mline</option>
                    <option value="Biohit Picus" ${isSelected('Biohit Picus')}>Biohit Picus</option>
                    <option value="Biohit Proline Plus" ${isSelected('Biohit Proline Plus')}>Biohit Proline Plus</option>
                </optgroup>
                <optgroup label="‚îÄ‚îÄ Other Brands ‚îÄ‚îÄ">
                    <option value="Accupet" ${isSelected('Accupet')}>Accupet</option>
                    <option value="Accupette" ${isSelected('Accupette')}>Accupette</option>
                    <option value="Accu-jet pro" ${isSelected('Accu-jet pro')}>Accu-jet pro</option>
                    <option value="Accumax" ${isSelected('Accumax')}>Accumax</option>
                    <option value="Alphapette" ${isSelected('Alphapette')}>Alphapette</option>
                    <option value="Alphalite" ${isSelected('Alphalite')}>Alphalite</option>
                    <option value="Benchmate" ${isSelected('Benchmate')}>Benchmate</option>
                    <option value="Benchmate II" ${isSelected('Benchmate II')}>Benchmate II</option>
                    <option value="Betapet" ${isSelected('Betapet')}>Betapet</option>
                    <option value="Bio Rad" ${isSelected('Bio Rad')}>Bio Rad</option>
                    <option value="Cole Palmer" ${isSelected('Cole Palmer')}>Cole Palmer</option>
                    <option value="Costar" ${isSelected('Costar')}>Costar</option>
                    <option value="Denville 3000" ${isSelected('Denville 3000')}>Denville 3000</option>
                    <option value="Denville 3000i" ${isSelected('Denville 3000i')}>Denville 3000i</option>
                    <option value="Denville Ultra" ${isSelected('Denville Ultra')}>Denville Ultra</option>
                    <option value="Dispensette Organice Bottle Filler" ${isSelected('Dispensette Organice Bottle Filler')}>Dispensette Organice Bottle Filler</option>
                    <option value="ErgoOne" ${isSelected('ErgoOne')}>ErgoOne</option>
                    <option value="Genemate" ${isSelected('Genemate')}>Genemate</option>
                    <option value="HandyStep Touch" ${isSelected('HandyStep Touch')}>HandyStep Touch</option>
                    <option value="IKA Pette" ${isSelected('IKA Pette')}>IKA Pette</option>
                    <option value="Integra" ${isSelected('Integra')}>Integra</option>
                    <option value="Integra Electronic" ${isSelected('Integra Electronic')}>Integra Electronic</option>
                    <option value="Integrapette" ${isSelected('Integrapette')}>Integrapette</option>
                    <option value="Jencons" ${isSelected('Jencons')}>Jencons</option>
                    <option value="Labnet" ${isSelected('Labnet')}>Labnet</option>
                    <option value="Lambda" ${isSelected('Lambda')}>Lambda</option>
                    <option value="Lambda eliteTouch" ${isSelected('Lambda eliteTouch')}>Lambda eliteTouch</option>
                    <option value="Lambda Plus" ${isSelected('Lambda Plus')}>Lambda Plus</option>
                    <option value="megaZen Seriological" ${isSelected('megaZen Seriological')}>megaZen Seriological</option>
                    <option value="Mettler VoluMate" ${isSelected('Mettler VoluMate')}>Mettler VoluMate</option>
                    <option value="MidSci" ${isSelected('MidSci')}>MidSci</option>
                    <option value="Nichipet" ${isSelected('Nichipet')}>Nichipet</option>
                    <option value="Nichipet EX" ${isSelected('Nichipet EX')}>Nichipet EX</option>
                    <option value="Nichipet EX II" ${isSelected('Nichipet EX II')}>Nichipet EX II</option>
                    <option value="Nichipet Premium" ${isSelected('Nichipet Premium')}>Nichipet Premium</option>
                    <option value="NO ID" ${isSelected('NO ID')}>NO ID</option>
                    <option value="OniLab" ${isSelected('OniLab')}>OniLab</option>
                    <option value="Pipet-aid" ${isSelected('Pipet-aid')}>Pipet-aid</option>
                    <option value="Proline" ${isSelected('Proline')}>Proline</option>
                    <option value="SciLogex" ${isSelected('SciLogex')}>SciLogex</option>
                    <option value="Sealpette" ${isSelected('Sealpette')}>Sealpette</option>
                    <option value="Socorex" ${isSelected('Socorex')}>Socorex</option>
                    <option value="Surepette" ${isSelected('Surepette')}>Surepette</option>
                    <option value="Transferpet" ${isSelected('Transferpet')}>Transferpet</option>
                    <option value="Transferpet S" ${isSelected('Transferpet S')}>Transferpet S</option>
                    <option value="United" ${isSelected('United')}>United</option>
                    <option value="Viaflo" ${isSelected('Viaflo')}>Viaflo</option>
                    <option value="Watson Nexty" ${isSelected('Watson Nexty')}>Watson Nexty</option>
                </optgroup>
                <optgroup label="‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ">
                    <option value="Other">Other (specify)</option>
                </optgroup>
            `;
        }

        function renderPipette(pipette) {
            const container = document.getElementById('pipettesContainer');

            const card = document.createElement('div');
            card.className = 'pipette-card';
            card.id = `pipette-${pipette.id}`;

            card.innerHTML = `
                <div class="pipette-header">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" class="pipette-checkbox" id="checkbox-${pipette.id}"
                               style="width: 18px; height: 18px; cursor: pointer;"
                               onchange="updateBulkButtons()">
                        <h3 id="pipette-banner-${pipette.id}" style="margin: 0;">${getPipetteBanner(pipette)}</h3>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-secondary" onclick="duplicatePipette(${pipette.id})" style="padding: 6px 12px; font-size: 12px;">
                            üìã Duplicate
                        </button>
                        <button class="btn btn-danger" onclick="removePipette(${pipette.id})" style="padding: 6px 12px; font-size: 12px;">
                            ‚úï Remove
                        </button>
                    </div>
                </div>
                <div class="pipette-body">
                    <!-- Serial Number, Make/Model and Max Volume -->
                    <div class="pipette-row">
                        <div class="form-group">
                            <label>Serial Number</label>
                            <input type="text" id="serial-${pipette.id}" value="${pipette.serialNumber || ''}"
                                   onchange="updatePipetteField(${pipette.id}, 'serialNumber', this.value)"
                                   placeholder="e.g., SN123456">
                        </div>
                        <div class="form-group">
                            <label>Make/Model</label>
                            <select id="makeModel-${pipette.id}" onchange="updatePipetteField(${pipette.id}, 'makeModel', this.value)"
                                    style="width: 100%;">
                                ${generateMakeModelOptions(pipette.makeModel)}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Max Volume (¬µL)</label>
                            <input type="number" id="vol-${pipette.id}" value="${pipette.maxVolume}"
                                   onchange="updatePipetteField(${pipette.id}, 'maxVolume', this.value)"
                                   placeholder="e.g., 100">
                        </div>
                    </div>

                    <!-- Other Make/Model specify field (shows when "Other" selected) -->
                    ${pipette.makeModel === 'Other' || (pipette.makeModel && !['Accupet','Accupette','Accu-jet pro','Accumax','Alphapette','Alphalite','Benchmate','Benchmate II','Betapet','Bio Rad','Biohit eline','Biohit mline','Biohit Picus','Biohit Proline Plus','Cole Palmer','Costar','Denville 3000','Denville 3000i','Denville Ultra','Dispensette Organice Bottle Filler','Epp Handy Step','Epp Repeater','Epp Research','Epp Research Plus','Epp Xplorer plus','Eppendorf 4700','Eppendorf 4710','Eppendorf Black','Eppendorf brown','Eppendorf Reference','Eppendorf Reference 2','Eppendorf Repeater E3','Eppendorf Repeater M4','Eppendorf Xplorer','ErgoOne','Finn','Finn Clip tip','Finn Colours','Finn Digital','Finn F1','Finn Focus','Finn II','Finn Labsystem Repeater','Finnpipette','Finnpipette II','Fisher elite Finn F1','Fisher elite Finn F2','Fisher Finn','Fisherbrand','Fisherbrand HandyStep S','Fisherbrand Repeater','Genemate','Gilson','Gilson Microman','Gilson Neo','Gilson Pipetman','Gilson Ultra','HandyStep Touch','IKA Pette','Integra','Integra Electronic','Integrapette','Jencons','Labnet','Lambda','Lambda eliteTouch','Lambda Plus','megaZen Seriological','Mettler VoluMate','MidSci','Nichipet','Nichipet EX','Nichipet EX II','Nichipet Premium','NO ID','OniLab','Pipet-aid','Proline','Rainin AutoRep E','Rainin Classic','Rainin EDP3','Rainin NanoRep','Rainin Pipete Plus SL','Rainin Pipete XLS SL','Rainin Pipette Lite','Rainin Pipette Lite E4','Rainin Pipette Lite SL','Rainin Pipette Lite XLS','Rainin Pipette Lite XLS E4','Rainin Pipette Plus','SciLogex','Sealpette','Socorex','Surepette','Thermo Scientific Matrix','Thermo Scientific S1','Transferpet','Transferpet S','United','Viaflo','VWR','VWR Blue','VWR Electronic','VWR Ergonomic','VWR Ergonomic HP','VWR Labpette','VWR LTS Comp','VWR Sealpette','VWR Ultra','Watson Nexty'].includes(pipette.makeModel) && pipette.makeModel !== '') ? `
                    <div class="pipette-row">
                        <div class="form-group" style="grid-column: span 3;">
                            <label>Specify Make/Model</label>
                            <input type="text" id="makeModelOther-${pipette.id}" value="${pipette.makeModel !== 'Other' ? pipette.makeModel : ''}"
                                   onchange="updatePipetteField(${pipette.id}, 'makeModel', this.value)"
                                   placeholder="Enter make/model..."
                                   style="width: 100%;">
                        </div>
                    </div>` : ''}

                    <!-- In Spec / Out Spec -->
                    <div class="pipette-row">
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="inspec-${pipette.id}"
                                       ${pipette.inSpec ? 'checked' : ''}
                                       onchange="updatePipetteCheckbox(${pipette.id}, 'inSpec', this.checked)">
                                <strong style="color: #69B135;">‚úì IN SPEC</strong>
                            </label>
                            <label>
                                <input type="checkbox" id="outspec-${pipette.id}"
                                       ${pipette.outSpec ? 'checked' : ''}
                                       onchange="updatePipetteCheckbox(${pipette.id}, 'outSpec', this.checked)">
                                <strong style="color: #dc3545;">‚úó OUT SPEC</strong>
                            </label>
                        </div>
                    </div>

                    <!-- Adjustments & Repairs -->
                    <div class="pipette-row">
                        <div style="grid-column: 1 / -1;">
                            <label style="font-weight: 600; color: #223077; margin-bottom: 8px; display: block;">
                                Adjustments & Repairs
                            </label>
                            <div class="checkbox-group">
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <label style="font-weight: 600; margin: 0;">SE:<span class="tooltip">‚ÑπÔ∏è<span class="tooltiptext">Seal Type</span></span></label>
                                    <select id="adj-SE-${pipette.id}" onchange="updateAdjustment(${pipette.id}, 'SE', this.value)"
                                            style="padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; min-width: 120px;">
                                        <option value=""></option>
                                        <option value="*" ${pipette.adjustments.SE === '*' ? 'selected' : ''}>*</option>
                                        <option value="X" ${pipette.adjustments.SE === 'X' ? 'selected' : ''}>X</option>
                                        <option value="Silicone" ${pipette.adjustments.SE === 'Silicone' ? 'selected' : ''}>Silicone</option>
                                        <option value="No seal" ${pipette.adjustments.SE === 'No seal' ? 'selected' : ''}>No seal</option>
                                        <option value="Other" ${(pipette.adjustments.SE && pipette.adjustments.SE !== '*' && pipette.adjustments.SE !== 'X' && pipette.adjustments.SE !== 'Silicone' && pipette.adjustments.SE !== 'No seal' && pipette.adjustments.SE !== '') ? 'selected' : ''}>Other</option>
                                    </select>
                                    <input type="text" id="adj-SE-OTHER-${pipette.id}" value="${(pipette.adjustments.SE && pipette.adjustments.SE !== '*' && pipette.adjustments.SE !== 'X' && pipette.adjustments.SE !== 'Silicone' && pipette.adjustments.SE !== 'No seal' && pipette.adjustments.SE !== '') ? pipette.adjustments.SE : ''}"
                                           onchange="updateSEOther(${pipette.id}, this.value)"
                                           placeholder="Specify other..."
                                           style="padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; width: 120px; display: ${(pipette.adjustments.SE && pipette.adjustments.SE !== '*' && pipette.adjustments.SE !== 'X' && pipette.adjustments.SE !== 'Silicone' && pipette.adjustments.SE !== 'No seal' && pipette.adjustments.SE !== '') ? 'inline-block' : 'none'};">
                                </div>
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <label style="font-weight: 600; margin: 0;">COR:<span class="tooltip">‚ÑπÔ∏è<span class="tooltiptext">Corrosion Level</span></span></label>
                                    <select id="adj-COR-${pipette.id}" onchange="updateAdjustment(${pipette.id}, 'COR', this.value)"
                                            style="padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; min-width: 80px;">
                                        <option value=""></option>
                                        <option value="*" ${pipette.adjustments.COR === '*' ? 'selected' : ''}>*</option>
                                        <option value="**" ${pipette.adjustments.COR === '**' ? 'selected' : ''}>**</option>
                                        <option value="***" ${pipette.adjustments.COR === '***' ? 'selected' : ''}>***</option>
                                        <option value="Other" ${(pipette.adjustments.COR && pipette.adjustments.COR !== '*' && pipette.adjustments.COR !== '**' && pipette.adjustments.COR !== '***' && pipette.adjustments.COR !== '') ? 'selected' : ''}>Other</option>
                                    </select>
                                    <input type="text" id="adj-COR-OTHER-${pipette.id}" value="${(pipette.adjustments.COR && pipette.adjustments.COR !== '*' && pipette.adjustments.COR !== '**' && pipette.adjustments.COR !== '***' && pipette.adjustments.COR !== '') ? pipette.adjustments.COR : ''}"
                                           onchange="updateCOROther(${pipette.id}, this.value)"
                                           placeholder="Specify..."
                                           style="padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; width: 100px; display: ${(pipette.adjustments.COR && pipette.adjustments.COR !== '*' && pipette.adjustments.COR !== '**' && pipette.adjustments.COR !== '***' && pipette.adjustments.COR !== '') ? 'inline-block' : 'none'};">
                                </div>
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <label style="font-weight: 600; margin: 0;">G:<span class="tooltip">‚ÑπÔ∏è<span class="tooltiptext">Grease Applied</span></span></label>
                                    <select id="adj-G-${pipette.id}" onchange="updateAdjustment(${pipette.id}, 'G', this.value)"
                                            style="padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; min-width: 80px;">
                                        <option value=""></option>
                                        <option value="D" ${pipette.adjustments.G === 'D' ? 'selected' : ''}>D</option>
                                        <option value="K" ${pipette.adjustments.G === 'K' ? 'selected' : ''}>K</option>
                                        <option value="Other" ${(pipette.adjustments.G && pipette.adjustments.G !== 'D' && pipette.adjustments.G !== 'K' && pipette.adjustments.G !== '') ? 'selected' : ''}>Other</option>
                                    </select>
                                    <input type="text" id="adj-G-OTHER-${pipette.id}" value="${(pipette.adjustments.G && pipette.adjustments.G !== 'D' && pipette.adjustments.G !== 'K' && pipette.adjustments.G !== '') ? pipette.adjustments.G : ''}"
                                           onchange="updateGOther(${pipette.id}, this.value)"
                                           placeholder="Specify..."
                                           style="padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; width: 100px; display: ${(pipette.adjustments.G && pipette.adjustments.G !== 'D' && pipette.adjustments.G !== 'K' && pipette.adjustments.G !== '') ? 'inline-block' : 'none'};">
                                </div>
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <label style="font-weight: 600; margin: 0;">SH:<span class="tooltip">‚ÑπÔ∏è<span class="tooltiptext">Shaft Condition</span></span></label>
                                    <select id="adj-SH-${pipette.id}" onchange="updateAdjustment(${pipette.id}, 'SH', this.value)"
                                            style="padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; min-width: 80px;">
                                        <option value=""></option>
                                        <option value="X" ${pipette.adjustments.SH === 'X' ? 'selected' : ''}>X</option>
                                        <option value="Other" ${(pipette.adjustments.SH && pipette.adjustments.SH !== 'X' && pipette.adjustments.SH !== '') ? 'selected' : ''}>Other</option>
                                    </select>
                                    <input type="text" id="adj-SH-OTHER-${pipette.id}" value="${(pipette.adjustments.SH && pipette.adjustments.SH !== 'X' && pipette.adjustments.SH !== '') ? pipette.adjustments.SH : ''}"
                                           onchange="updateSHOther(${pipette.id}, this.value)"
                                           placeholder="Specify..."
                                           style="padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; width: 100px; display: ${(pipette.adjustments.SH && pipette.adjustments.SH !== 'X' && pipette.adjustments.SH !== '') ? 'inline-block' : 'none'};">
                                </div>
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <label style="font-weight: 600; margin: 0;">FR:<span class="tooltip">‚ÑπÔ∏è<span class="tooltiptext">Friction Ring</span></span></label>
                                    <select id="adj-FR-${pipette.id}" onchange="updateAdjustment(${pipette.id}, 'FR', this.value)"
                                            style="padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; min-width: 80px;">
                                        <option value=""></option>
                                        <option value="Reg" ${pipette.adjustments.FR === 'Reg' ? 'selected' : ''}>Reg</option>
                                        <option value="Skinny" ${pipette.adjustments.FR === 'Skinny' ? 'selected' : ''}>Skinny</option>
                                        <option value="Fat" ${pipette.adjustments.FR === 'Fat' ? 'selected' : ''}>Fat</option>
                                    </select>
                                </div>
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <label style="font-weight: 600; margin: 0;">O:<span class="tooltip">‚ÑπÔ∏è<span class="tooltiptext">O-Ring Condition</span></span></label>
                                    <select id="adj-O-${pipette.id}" onchange="updateAdjustment(${pipette.id}, 'O', this.value)"
                                            style="padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; min-width: 80px;">
                                        <option value=""></option>
                                        <option value="X" ${pipette.adjustments.O === 'X' ? 'selected' : ''}>X</option>
                                        <option value="Other" ${(pipette.adjustments.O && pipette.adjustments.O !== 'X' && pipette.adjustments.O !== '') ? 'selected' : ''}>Other</option>
                                    </select>
                                    <input type="text" id="adj-O-OTHER-${pipette.id}" value="${(pipette.adjustments.O && pipette.adjustments.O !== 'X' && pipette.adjustments.O !== '') ? pipette.adjustments.O : ''}"
                                           onchange="updateOOther(${pipette.id}, this.value)"
                                           placeholder="Specify..."
                                           style="padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; width: 100px; display: ${(pipette.adjustments.O && pipette.adjustments.O !== 'X' && pipette.adjustments.O !== '') ? 'inline-block' : 'none'};">
                                </div>
                                <input type="text" id="adj-OTHER-${pipette.id}" value="${pipette.adjustments.OTHER}"
                                       onchange="updateAdjustment(${pipette.id}, 'OTHER', this.value)"
                                       placeholder="Other..." style="padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; width: 120px;">
                            </div>
                        </div>
                    </div>

                    <!-- Final Corrected Volumes -->
                    <div class="pipette-row">
                        <div style="grid-column: 1 / -1;">
                            <div class="measurement-section as-left-section">
                                <div class="measurement-section-header" style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span>üìä</span>
                                        <span>Final Corrected Volumes (¬µL)</span>
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <button class="voice-button" id="voice-btn-${pipette.id}" onclick="toggleVoiceInput(${pipette.id})" title="Start voice input for readings">
                                            üé§ Voice Input
                                        </button>
                                        <span class="voice-status" id="voice-status-${pipette.id}"></span>
                                    </div>
                                </div>
                                <div class="volume-inputs">
                                    <div>
                                        <label style="font-size: 12px; color: #6c757d; margin-bottom: 5px; display: block; text-align: center;">Reading 1</label>
                                        <input type="number" step="0.001" id="vol1-${pipette.id}" value="${pipette.finalVolumes[0]}"
                                               onchange="updateFinalVolume(${pipette.id}, 0, this.value)" placeholder="0.000">
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #6c757d; margin-bottom: 5px; display: block; text-align: center;">Reading 2</label>
                                        <input type="number" step="0.001" id="vol2-${pipette.id}" value="${pipette.finalVolumes[1]}"
                                               onchange="updateFinalVolume(${pipette.id}, 1, this.value)" placeholder="0.000">
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #6c757d; margin-bottom: 5px; display: block; text-align: center;">Reading 3</label>
                                        <input type="number" step="0.001" id="vol3-${pipette.id}" value="${pipette.finalVolumes[2]}"
                                               onchange="updateFinalVolume(${pipette.id}, 2, this.value)" placeholder="0.000">
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #6c757d; margin-bottom: 5px; display: block; text-align: center;">Reading 4</label>
                                        <input type="number" step="0.001" id="vol4-${pipette.id}" value="${pipette.finalVolumes[3]}"
                                               onchange="updateFinalVolume(${pipette.id}, 3, this.value)" placeholder="0.000">
                                    </div>
                                </div>
                                <!-- Real-time Statistics Display -->
                                <div id="stats-${pipette.id}" style="margin-top: 15px; padding: 12px; background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 6px; display: none;">
                                    <div style="font-weight: 600; color: #2c5282; margin-bottom: 8px; font-size: 13px;">üìä Statistics</div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
                                        <div><strong>Mean:</strong> <span id="stat-mean-${pipette.id}">‚Äî</span> ¬µL</div>
                                        <div><strong>CV%:</strong> <span id="stat-cv-${pipette.id}">‚Äî</span> <span id="stat-cv-status-${pipette.id}"></span></div>
                                        <div><strong>SD:</strong> <span id="stat-sd-${pipette.id}">‚Äî</span> ¬µL</div>
                                        <div><strong>Range:</strong> <span id="stat-range-${pipette.id}">‚Äî</span></div>
                                    </div>
                                    <div id="outlier-warning-${pipette.id}" style="margin-top: 10px; padding: 8px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; display: none; font-size: 12px;">
                                        <strong>‚ö†Ô∏è Outlier Detected:</strong> <span id="outlier-message-${pipette.id}"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pass/Fail and Comments -->
                    <div class="pipette-row">
                        <div class="form-group">
                            <label>Final Status</label>
                            <select id="pf-${pipette.id}" onchange="updatePipetteField(${pipette.id}, 'passFail', this.value)">
                                <option value="">-- Select --</option>
                                <option value="P" ${pipette.passFail === 'P' ? 'selected' : ''}>‚úì PASS</option>
                                <option value="F" ${pipette.passFail === 'F' ? 'selected' : ''}>‚úó FAIL</option>
                                <option value="R" ${pipette.passFail === 'R' ? 'selected' : ''}>üîß Taken for Repair</option>
                                <option value="OOS" ${pipette.passFail === 'OOS' ? 'selected' : ''}>‚õî OOS</option>
                            </select>
                        </div>
                        <div class="form-group" style="grid-column: span 2;">
                            <label>Comments</label>
                            <input type="text" id="comments-${pipette.id}" value="${pipette.comments}"
                                   onchange="updatePipetteField(${pipette.id}, 'comments', this.value)"
                                   placeholder="Optional notes...">
                        </div>
                    </div>

                    ${pipette.passFail ? `<div style="margin-top: 10px; text-align: right;">
                        <span class="status-indicator status-${
                            pipette.passFail === 'P' ? 'pass' :
                            pipette.passFail === 'F' ? 'fail' :
                            pipette.passFail === 'R' ? 'pending' :
                            pipette.passFail === 'OOS' ? 'fail' : 'pending'}">
                            ${
                                pipette.passFail === 'P' ? '‚úì PASS' :
                                pipette.passFail === 'F' ? '‚úó FAIL' :
                                pipette.passFail === 'R' ? 'üîß Taken for Repair' :
                                pipette.passFail === 'OOS' ? '‚õî OOS' : pipette.passFail
                            }
                        </span>
                    </div>` : ''}
                </div>
            `;

            container.appendChild(card);
        }

        function renderAllPipettes() {
            const container = document.getElementById('pipettesContainer');
            container.innerHTML = '';
            pipettes.forEach(pipette => renderPipette(pipette));
            updateEmptyState();
        }

        function duplicatePipette(pipetteId) {
            saveStateForUndo('Duplicate pipette');
            const sourcePipette = pipettes.find(p => p.id === pipetteId);
            if (!sourcePipette) return;

            currentPipetteId++;
            const newPipette = {
                id: currentPipetteId,
                number: String(currentPipetteId).padStart(2, '0'),
                serialNumber: '',  // CLEARED - must be unique
                makeModel: sourcePipette.makeModel,
                maxVolume: sourcePipette.maxVolume,
                inSpec: sourcePipette.inSpec,
                outSpec: sourcePipette.outSpec,
                adjustments: { ...sourcePipette.adjustments },  // Copy adjustments
                finalVolumes: ['', '', '', ''],  // CLEARED - new measurements needed
                passFail: '',  // CLEARED
                comments: ''  // CLEARED
            };

            pipettes.push(newPipette);
            renderPipette(newPipette);
            updateProgress();
            updateEmptyState();
            debouncedAutoSave();

            // Scroll to the new pipette
            setTimeout(() => {
                document.getElementById(`pipette-${newPipette.id}`)?.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        }

        function removePipette(pipetteId) {
            saveStateForUndo('Remove pipette');
            pipettes = pipettes.filter(p => p.id !== pipetteId);
            const element = document.getElementById(`pipette-${pipetteId}`);
            if (element) element.remove();
            updateEmptyState();
            updateProgress();
            debouncedAutoSave();
        }

        function updatePipetteField(pipetteId, field, value) {
            const pipette = pipettes.find(p => p.id === pipetteId);
            if (pipette) {
                pipette[field] = value;

                // Check for duplicate serial numbers
                if (field === 'serialNumber' && value.trim() !== '') {
                    checkDuplicateSerial(pipetteId, value);
                }

                // Update banner if serial number or make/model changed
                if (field === 'serialNumber' || field === 'makeModel') {
                    const banner = document.getElementById(`pipette-banner-${pipetteId}`);
                    if (banner) {
                        banner.textContent = getPipetteBanner(pipette);
                    }
                }

                // Re-render if makeModel changed to/from "Other" to show/hide text field
                if (field === 'makeModel') {
                    renderAllPipettes();
                }

                // Re-render status indicator if Pass/Fail changed
                if (field === 'passFail') {
                    renderAllPipettes();
                }

                debouncedAutoSave();
            }
        }

        // Check for duplicate serial numbers
        function checkDuplicateSerial(pipetteId, serial) {
            const duplicates = pipettes.filter(p =>
                p.id !== pipetteId &&
                p.serialNumber.toLowerCase().trim() === serial.toLowerCase().trim()
            );

            const serialField = document.getElementById(`serial-${pipetteId}`);
            if (!serialField) return;

            if (duplicates.length > 0) {
                // Highlight field
                serialField.style.backgroundColor = '#fff3cd';
                serialField.style.borderColor = '#ffc107';
                serialField.style.borderWidth = '2px';

                // Show warning (non-blocking)
                const duplicateIds = duplicates.map(p => `#${p.number}`).join(', ');
                showConfirm(
                    `Serial "${serial}" is already used in pipette(s) ${duplicateIds}.\n\nThis could be:\n‚Ä¢ Same pipette entered twice (mistake)\n‚Ä¢ Different pipette with same serial (rare)\n‚Ä¢ Copy/paste error\n\nContinue anyway?`,
                    '‚ö†Ô∏è Duplicate Serial Number',
                    () => {
                        // User confirmed - keep it
                        console.log('User accepted duplicate serial');
                    }
                );
            } else {
                // Clear highlighting
                serialField.style.backgroundColor = '';
                serialField.style.borderColor = '';
                serialField.style.borderWidth = '';
            }
        }

        function updatePipetteCheckbox(pipetteId, field, checked) {
            const pipette = pipettes.find(p => p.id === pipetteId);
            if (pipette) {
                pipette[field] = checked;
                debouncedAutoSave();
            }
        }

        function updateAdjustment(pipetteId, adjustmentType, value) {
            const pipette = pipettes.find(p => p.id === pipetteId);
            if (pipette) {
                // Special handling for SE dropdown
                if (adjustmentType === 'SE') {
                    const otherInput = document.getElementById(`adj-SE-OTHER-${pipetteId}`);
                    if (value === 'Other') {
                        if (otherInput) {
                            otherInput.style.display = 'inline-block';
                            otherInput.focus();
                        }
                        if (!pipette.adjustments.SE || pipette.adjustments.SE === '*' ||
                            pipette.adjustments.SE === 'X' || pipette.adjustments.SE === 'Silicone' ||
                            pipette.adjustments.SE === 'No seal' || pipette.adjustments.SE === '') {
                            pipette.adjustments.SE = '';
                        }
                    } else {
                        if (otherInput) {
                            otherInput.style.display = 'none';
                            otherInput.value = '';
                        }
                        pipette.adjustments.SE = value;
                    }
                }
                // Special handling for COR dropdown
                else if (adjustmentType === 'COR') {
                    const otherInput = document.getElementById(`adj-COR-OTHER-${pipetteId}`);
                    if (value === 'Other') {
                        if (otherInput) {
                            otherInput.style.display = 'inline-block';
                            otherInput.focus();
                        }
                        if (!pipette.adjustments.COR || pipette.adjustments.COR === '*' ||
                            pipette.adjustments.COR === '**' || pipette.adjustments.COR === '***' ||
                            pipette.adjustments.COR === '') {
                            pipette.adjustments.COR = '';
                        }
                    } else {
                        if (otherInput) {
                            otherInput.style.display = 'none';
                            otherInput.value = '';
                        }
                        pipette.adjustments.COR = value;
                    }
                }
                // Special handling for G dropdown
                else if (adjustmentType === 'G') {
                    const otherInput = document.getElementById(`adj-G-OTHER-${pipetteId}`);
                    if (value === 'Other') {
                        if (otherInput) {
                            otherInput.style.display = 'inline-block';
                            otherInput.focus();
                        }
                        if (!pipette.adjustments.G || pipette.adjustments.G === 'D' ||
                            pipette.adjustments.G === 'K' || pipette.adjustments.G === '') {
                            pipette.adjustments.G = '';
                        }
                    } else {
                        if (otherInput) {
                            otherInput.style.display = 'none';
                            otherInput.value = '';
                        }
                        pipette.adjustments.G = value;
                    }
                }
                // Special handling for SH dropdown
                else if (adjustmentType === 'SH') {
                    const otherInput = document.getElementById(`adj-SH-OTHER-${pipetteId}`);
                    if (value === 'Other') {
                        if (otherInput) {
                            otherInput.style.display = 'inline-block';
                            otherInput.focus();
                        }
                        if (!pipette.adjustments.SH || pipette.adjustments.SH === 'X' ||
                            pipette.adjustments.SH === '') {
                            pipette.adjustments.SH = '';
                        }
                    } else {
                        if (otherInput) {
                            otherInput.style.display = 'none';
                            otherInput.value = '';
                        }
                        pipette.adjustments.SH = value;
                    }
                }
                // FR dropdown (no "Other" option needed)
                else if (adjustmentType === 'FR') {
                    pipette.adjustments.FR = value;
                }
                // Special handling for O dropdown
                else if (adjustmentType === 'O') {
                    const otherInput = document.getElementById(`adj-O-OTHER-${pipetteId}`);
                    if (value === 'Other') {
                        if (otherInput) {
                            otherInput.style.display = 'inline-block';
                            otherInput.focus();
                        }
                        if (!pipette.adjustments.O || pipette.adjustments.O === 'X' ||
                            pipette.adjustments.O === '') {
                            pipette.adjustments.O = '';
                        }
                    } else {
                        if (otherInput) {
                            otherInput.style.display = 'none';
                            otherInput.value = '';
                        }
                        pipette.adjustments.O = value;
                    }
                }
                else {
                    pipette.adjustments[adjustmentType] = value;
                }
                debouncedAutoSave();
            }
        }

        function updateSEOther(pipetteId, value) {
            const pipette = pipettes.find(p => p.id === pipetteId);
            if (pipette) {
                pipette.adjustments.SE = value;
                debouncedAutoSave();
            }
        }

        function updateCOROther(pipetteId, value) {
            const pipette = pipettes.find(p => p.id === pipetteId);
            if (pipette) {
                pipette.adjustments.COR = value;
                debouncedAutoSave();
            }
        }

        function updateGOther(pipetteId, value) {
            const pipette = pipettes.find(p => p.id === pipetteId);
            if (pipette) {
                pipette.adjustments.G = value;
                debouncedAutoSave();
            }
        }

        function updateSHOther(pipetteId, value) {
            const pipette = pipettes.find(p => p.id === pipetteId);
            if (pipette) {
                pipette.adjustments.SH = value;
                debouncedAutoSave();
            }
        }

        function updateOOther(pipetteId, value) {
            const pipette = pipettes.find(p => p.id === pipetteId);
            if (pipette) {
                pipette.adjustments.O = value;
                debouncedAutoSave();
            }
        }

        function updateFinalVolume(pipetteId, index, value) {
            const pipette = pipettes.find(p => p.id === pipetteId);
            if (pipette) {
                pipette.finalVolumes[index] = value;
                validatePipette(pipetteId);
                debouncedAutoSave();
            }
        }

        // ========================================
        // ISO 8655 VALIDATION FUNCTIONS
        // ========================================

        function calculateCV(values) {
            const numericValues = values.filter(v => v !== '' && v !== null && !isNaN(v)).map(v => parseFloat(v));
            if (numericValues.length < 4) return null;

            const mean = numericValues.reduce((a, b) => a + b, 0) / numericValues.length;
            const variance = numericValues.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / numericValues.length;
            const stdDev = Math.sqrt(variance);
            return (stdDev / mean) * 100;
        }

        function calculateSD(values) {
            const numericValues = values.filter(v => v !== '' && v !== null && !isNaN(v)).map(v => parseFloat(v));
            if (numericValues.length < 4) return null;

            const mean = numericValues.reduce((a, b) => a + b, 0) / numericValues.length;
            const variance = numericValues.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / numericValues.length;
            const stdDev = Math.sqrt(variance);
            return stdDev;
        }

        function getNominalVolume(pipette) {
            // For basic calibration, we'll use the Max Volume field
            // This is more flexible than parsing the model name
            if (pipette.maxVolume && pipette.maxVolume !== '') {
                return parseFloat(pipette.maxVolume);
            }

            // Fallback: try to extract from model name (e.g., "P-1000" -> 1000)
            const match = pipette.model.match(/P-(\d+)/);
            if (match) {
                return parseFloat(match[1]);
            }

            return null;
        }

        function getSpecifications(volume) {
            // Determine the ISO model name from the max volume
            // e.g., 1000¬µL -> "P-1000"
            const isoModelName = `P-${volume}`;

            const modelSpecs = isoSpecs[isoModelName];
            if (!modelSpecs) {
                console.warn('No ISO specs found for volume:', volume, 'model:', isoModelName);
                return null;
            }

            // Find the closest matching volume in the specs
            const volumes = Object.keys(modelSpecs).map(v => parseFloat(v));
            const closest = volumes.reduce((prev, curr) =>
                Math.abs(curr - volume) < Math.abs(prev - volume) ? curr : prev
            );

            return modelSpecs[closest];
        }

        function validatePipette(pipetteId) {
            const pipette = pipettes.find(p => p.id === pipetteId);
            if (!pipette) return;

            // Get all 4 final volume measurements
            const measurements = pipette.finalVolumes.filter(v => v !== '' && v !== null && !isNaN(v)).map(v => parseFloat(v));

            // Show/update stats display even with partial data
            updateStatsDisplay(pipetteId, measurements);

            // Need all 4 measurements to validate
            if (measurements.length < 4) {
                // Clear any validation display
                updateValidationDisplay(pipetteId, null);
                return;
            }

            // Get nominal volume from pipette (uses maxVolume field or model name)
            const nominalVolume = getNominalVolume(pipette);
            if (!nominalVolume) {
                console.error('Could not determine nominal volume for pipette:', pipette);
                updateValidationDisplay(pipetteId, null);
                return;
            }

            // Get ISO 8655 specifications
            const specs = getSpecifications(nominalVolume);
            if (!specs) {
                console.error('No ISO specs found for volume:', nominalVolume);
                updateValidationDisplay(pipetteId, null);
                return;
            }

            // Calculate statistics
            const mean = measurements.reduce((a, b) => a + b, 0) / 4;
            const cv = calculateCV(measurements);
            const sd = calculateSD(measurements);

            // Detect outliers
            detectOutliers(pipetteId, measurements, mean, sd);

            // Check accuracy: ALL readings must be within range
            const accuracyPass = measurements.every(reading =>
                reading >= specs.accuracy.from && reading <= specs.accuracy.to
            );

            // ISO 8655: Precision passes if EITHER CV% OR SD meets limit
            const cvPass = cv <= specs.precision.percent;
            const sdPass = sd <= specs.precision.ul;
            const precisionPass = cvPass || sdPass;

            // Overall pass requires both accuracy and precision to pass
            const overallPass = accuracyPass && precisionPass;

            // Auto-update Pass/Fail dropdown (only if not manually set to R or OOS)
            const pfSelect = document.getElementById(`pf-${pipetteId}`);
            if (pfSelect && pipette.passFail !== 'R' && pipette.passFail !== 'OOS') {
                pipette.passFail = overallPass ? 'P' : 'F';
                pfSelect.value = pipette.passFail;
            }

            // Update validation display with detailed info
            updateValidationDisplay(pipetteId, {
                nominal: nominalVolume,
                mean: mean,
                cv: cv,
                sd: sd,
                specs: specs,
                accuracyPass: accuracyPass,
                precisionPass: precisionPass,
                cvPass: cvPass,
                sdPass: sdPass,
                overallPass: overallPass,
                measurements: measurements
            });

            // Update the status indicator if it exists (without re-rendering everything)
            const existingIndicator = document.querySelector(`#pipette-${pipetteId} .status-indicator`);
            if (existingIndicator && pipette.passFail !== 'R' && pipette.passFail !== 'OOS') {
                existingIndicator.className = `status-indicator status-${overallPass ? 'pass' : 'fail'}`;
                existingIndicator.textContent = overallPass ? '‚úì PASS' : '‚úó FAIL';
            }
        }

        // Update real-time statistics display
        function updateStatsDisplay(pipetteId, measurements) {
            const statsDiv = document.getElementById(`stats-${pipetteId}`);
            if (!statsDiv) return;

            if (measurements.length === 0) {
                statsDiv.style.display = 'none';
                return;
            }

            statsDiv.style.display = 'block';

            if (measurements.length < 4) {
                // Partial data - show what we have
                document.getElementById(`stat-mean-${pipetteId}`).textContent = '‚Äî';
                document.getElementById(`stat-cv-${pipetteId}`).textContent = '‚Äî';
                document.getElementById(`stat-sd-${pipetteId}`).textContent = '‚Äî';
                document.getElementById(`stat-range-${pipetteId}`).textContent = `${measurements.length}/4 readings`;
                document.getElementById(`stat-cv-status-${pipetteId}`).textContent = '';
                return;
            }

            // Calculate stats
            const mean = measurements.reduce((a, b) => a + b) / measurements.length;
            const variance = measurements.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / (measurements.length - 1);
            const sd = Math.sqrt(variance);
            const cv = (sd / mean) * 100;
            const min = Math.min(...measurements);
            const max = Math.max(...measurements);

            // Update display
            document.getElementById(`stat-mean-${pipetteId}`).textContent = mean.toFixed(3);
            document.getElementById(`stat-cv-${pipetteId}`).textContent = cv.toFixed(2) + '%';
            document.getElementById(`stat-sd-${pipetteId}`).textContent = sd.toFixed(3);
            document.getElementById(`stat-range-${pipetteId}`).textContent = `${min.toFixed(1)}-${max.toFixed(1)}`;

            // Color code CV%
            const cvStatus = document.getElementById(`stat-cv-status-${pipetteId}`);
            if (cv < 1.0) {
                cvStatus.textContent = '‚úì';
                cvStatus.style.color = '#28a745';
            } else if (cv < 2.0) {
                cvStatus.textContent = '‚ö†Ô∏è';
                cvStatus.style.color = '#ffc107';
            } else {
                cvStatus.textContent = '‚úó';
                cvStatus.style.color = '#dc3545';
            }
        }

        // Detect outliers in readings
        function detectOutliers(pipetteId, measurements, mean, sd) {
            const outlierWarning = document.getElementById(`outlier-warning-${pipetteId}`);
            const outlierMessage = document.getElementById(`outlier-message-${pipetteId}`);

            if (!outlierWarning || !outlierMessage) return;

            // Find outliers (>2 SD from mean)
            const outliers = [];
            measurements.forEach((val, idx) => {
                const zScore = Math.abs((val - mean) / sd);
                if (zScore > 2) {
                    const percentDiff = ((val - mean) / mean * 100).toFixed(1);
                    outliers.push({
                        index: idx + 1,
                        value: val.toFixed(3),
                        percentDiff: percentDiff
                    });
                }
            });

            if (outliers.length > 0) {
                outlierWarning.style.display = 'block';
                const messages = outliers.map(o =>
                    `Reading ${o.index} (${o.value} ¬µL) is ${o.percentDiff}% ${o.percentDiff > 0 ? 'above' : 'below'} mean. Double-check?`
                );
                outlierMessage.textContent = messages.join(' ');

                // Highlight outlier input fields
                outliers.forEach(o => {
                    const field = document.getElementById(`vol${o.index}-${pipetteId}`);
                    if (field) {
                        field.style.borderColor = '#ffc107';
                        field.style.borderWidth = '3px';
                    }
                });
            } else {
                outlierWarning.style.display = 'none';
                // Remove highlighting from all fields
                for (let i = 1; i <= 4; i++) {
                    const field = document.getElementById(`vol${i}-${pipetteId}`);
                    if (field) {
                        field.style.borderColor = '';
                        field.style.borderWidth = '';
                    }
                }
            }
        }

        function updateValidationDisplay(pipetteId, data) {
            // Find or create validation display div
            const pipetteCard = document.getElementById(`pipette-${pipetteId}`);
            if (!pipetteCard) return;

            const pipetteBody = pipetteCard.querySelector('.pipette-body');
            if (!pipetteBody) return;

            let validationDiv = pipetteBody.querySelector('.validation-results');

            if (!data) {
                // Clear validation display
                if (validationDiv) validationDiv.remove();
                return;
            }

            if (!validationDiv) {
                validationDiv = document.createElement('div');
                validationDiv.className = 'validation-results';
                validationDiv.style.cssText = 'background: #f8f9fa; padding: 15px; margin: 15px 0; border-radius: 8px; border-left: 4px solid ' + (data.overallPass ? '#28a745' : '#dc3545');

                // Find the Pass/Fail row and insert before it
                const pipetteRows = pipetteBody.querySelectorAll('.pipette-row');
                const passFailRow = pipetteRows[pipetteRows.length - 1]; // Last row is Pass/Fail
                if (passFailRow) {
                    pipetteBody.insertBefore(validationDiv, passFailRow);
                }
            } else {
                validationDiv.style.borderLeftColor = data.overallPass ? '#28a745' : '#dc3545';
            }

            validationDiv.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <strong style="color: #223077; font-size: 14px;">ISO 8655 Validation Results</strong>
                    <span class="status-indicator status-${data.overallPass ? 'pass' : 'fail'}" style="float: right;">
                        ${data.overallPass ? '‚úì PASS' : '‚úó FAIL'}
                    </span>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 12px;">
                    <div>
                        <strong>Nominal Volume:</strong> ${data.nominal.toFixed(2)} ¬µL
                    </div>
                    <div>
                        <strong>Mean:</strong> ${data.mean.toFixed(3)} ¬µL
                    </div>
                    <div>
                        <strong>Accuracy Range:</strong> ${data.specs.accuracy.from.toFixed(2)} - ${data.specs.accuracy.to.toFixed(2)} ¬µL
                        <span style="color: ${data.accuracyPass ? '#28a745' : '#dc3545'}; font-weight: bold; margin-left: 5px;">
                            ${data.accuracyPass ? '‚úì' : '‚úó'}
                        </span>
                    </div>
                    <div>
                        <strong>CV%:</strong> ${data.cv.toFixed(2)}% (limit: ‚â§${data.specs.precision.percent}%)
                        <span style="color: ${data.cvPass ? '#28a745' : '#dc3545'}; font-weight: bold; margin-left: 5px;">
                            ${data.cvPass ? '‚úì' : '‚úó'}
                        </span>
                    </div>
                    <div>
                        <strong>SD:</strong> ${data.sd.toFixed(3)} ¬µL (limit: ‚â§${data.specs.precision.ul} ¬µL)
                        <span style="color: ${data.sdPass ? '#28a745' : '#dc3545'}; font-weight: bold; margin-left: 5px;">
                            ${data.sdPass ? '‚úì' : '‚úó'}
                        </span>
                    </div>
                    <div>
                        <strong>Precision:</strong>
                        <span style="color: ${data.precisionPass ? '#28a745' : '#dc3545'}; font-weight: bold;">
                            ${data.precisionPass ? 'PASS' : 'FAIL'}
                        </span>
                        <em style="font-size: 10px; color: #6c757d; display: block;">
                            (CV% or SD must pass)
                        </em>
                    </div>
                </div>
            `;
        }

        function updateEmptyState() {
            const container = document.getElementById('pipettesContainer');
            if (pipettes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <h3 style="color: #6c757d; margin-bottom: 10px;">No Pipettes Added Yet</h3>
                        <p style="color: #adb5bd; margin-bottom: 30px;">Click "+ Add Pipette" to start your calibration</p>
                        <button class="btn btn-primary" onclick="addPipette()">
                            ‚ûï Add Your First Pipette
                        </button>
                    </div>
                `;
            }
            // Update bulk actions bar visibility
            updateBulkButtons();
        }

        function updateProgress() {
            const progressTextEl = document.getElementById('progressText');

            if (pipettes.length === 0) {
                document.getElementById('progressFill').style.width = '0%';
                if (progressTextEl) progressTextEl.textContent = '';
                return;
            }

            const completed = pipettes.filter(p => p.passFail !== '').length;
            const pending = pipettes.length - completed;
            const progress = (completed / pipettes.length) * 100;

            document.getElementById('progressFill').style.width = `${progress}%`;

            // Update progress text
            if (progressTextEl) {
                const passCount = pipettes.filter(p => p.passFail === 'P').length;
                const failCount = pipettes.filter(p => p.passFail === 'F').length;
                const repairCount = pipettes.filter(p => p.passFail === 'R').length;
                const oosCount = pipettes.filter(p => p.passFail === 'OOS').length;

                let statusParts = [];
                if (passCount > 0) statusParts.push(`${passCount} passed`);
                if (failCount > 0) statusParts.push(`${failCount} failed`);
                if (repairCount > 0) statusParts.push(`${repairCount} for repair`);
                if (oosCount > 0) statusParts.push(`${oosCount} OOS`);

                const statusText = statusParts.length > 0 ? ` (${statusParts.join(', ')})` : '';
                progressTextEl.textContent = `${pipettes.length} pipettes ‚Ä¢ ${completed} complete ‚Ä¢ ${pending} pending${statusText}`;
            }
        }

        function updateSummaryTable() {
            const tbody = document.getElementById('summaryTableBody');

            if (pipettes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 40px; color: #6c757d;">
                            No pipettes to display. Add pipettes in the Calibration tab.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = pipettes.map(p => {
                const adjustments = Object.entries(p.adjustments)
                    .filter(([key, val]) => val === true || (key === 'OTHER' && val !== ''))
                    .map(([key, val]) => key === 'OTHER' ? val : key)
                    .join(', ') || 'None';

                const volumes = p.finalVolumes.filter(v => v !== '').join(', ') || '--';

                return `
                    <tr onclick="jumpToPipette(${p.id})">
                        <td><strong>${p.number}</strong></td>
                        <td>${p.manufacturer || '--'}</td>
                        <td>${p.model || '--'}</td>
                        <td>${p.maxVolume || '--'}</td>
                        <td>${p.inSpec ? '‚úì' : ''}</td>
                        <td>${p.outSpec ? '‚úì' : ''}</td>
                        <td><small>${adjustments}</small></td>
                        <td><small>${volumes}</small></td>
                        <td>
                            ${p.passFail ? `<span class="status-indicator status-${p.passFail === 'P' ? 'pass' : 'fail'}">
                                ${p.passFail}
                            </span>` : '--'}
                        </td>
                        <td>
                            <button class="btn btn-secondary" onclick="event.stopPropagation(); jumpToPipette(${p.id})"
                                    style="padding: 4px 8px; font-size: 12px;">Edit</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function jumpToPipette(pipetteId) {
            // Switch to calibration tab
            showTab('calibration', document.querySelectorAll('.nav-tab')[1]);

            // Scroll to pipette card
            setTimeout(() => {
                const element = document.getElementById(`pipette-${pipetteId}`);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    element.style.boxShadow = '0 0 0 3px #69B135';
                    setTimeout(() => {
                        element.style.boxShadow = '';
                    }, 2000);
                }
            }, 100);
        }

        function newSession() {
            showConfirm("Start a new session? Current work will be saved.", "New Session", () => {
                // Auto-save current session
                autoSave();

                // Reset
                pipettes = [];
                currentPipetteId = 0;
                currentSessionId = null;

                // Clear form fields
                document.querySelectorAll('#session input').forEach(input => {
                    if (!['balanceModel', 'balanceSerial', 'technician'].includes(input.id)) {
                        input.value = '';
                    }
                });

                renderAllPipettes();
                updateProgress();
                showAlert('New session started', 'Success');
            });
        }

        function saveSession() {
            const sessionData = {
                sessionInfo: getSessionInfo(),
                pipettes: pipettes,
                timestamp: new Date().toISOString()
            };

            const dataStr = JSON.stringify(sessionData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `basic_calibration_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            // Record backup timestamp
            localStorage.setItem('lastBackupDate', Date.now().toString());

            showAlert('Session saved successfully!', 'Success');
        }

        function generateWorkOrderAndInvoice() {
            const pi = document.getElementById('pi')?.value || '';
            const technician = document.getElementById('technician')?.value || '';
            const serviceDateInput = document.getElementById('serviceDate')?.value;
            const frequency = document.getElementById('frequency')?.value || 'A';
            const counter = parseInt(document.getElementById('invoiceCounter')?.value || '1');

            // Use service date or today's date
            let day, month, year;
            if (serviceDateInput) {
                // Parse YYYY-MM-DD directly to avoid timezone issues
                const parts = serviceDateInput.split('-');
                year = parts[0].slice(-2); // Last 2 digits of year
                month = parts[1]; // Already 2 digits (01-12)
                day = parseInt(parts[2]); // No leading zero (1-31)
            } else {
                // Use today's date
                const today = new Date();
                day = today.getDate();
                month = String(today.getMonth() + 1).padStart(2, '0');
                year = String(today.getFullYear()).slice(-2);
            }

            // Generate Work Order Number: "Doerksen 12-22 1#A" (MM-DD format)
            if (pi) {
                const piLastName = pi.trim().split(' ').pop(); // Get last word as last name
                const workOrderNo = `${piLastName} ${month}-${day} ${counter}#${frequency}`;
                document.getElementById('workOrderNo').value = workOrderNo;

                // Auto-populate session name if empty
                const sessionNameField = document.getElementById('sessionName');
                if (sessionNameField && !sessionNameField.value) {
                    sessionNameField.value = workOrderNo;
                }
            }

            // Generate Invoice Number: "TSD2112241A"
            if (technician) {
                const techInitials = technician.trim().toUpperCase();
                const invoiceNo = `${techInitials}${day}${month}${year}${counter}${frequency}`;
                document.getElementById('invoiceNo').value = invoiceNo;
            }

            debouncedAutoSave();
        }

        function getSessionInfo() {
            return {
                sessionName: document.getElementById('sessionName')?.value || '',
                pi: document.getElementById('pi')?.value || '',
                piEmail: document.getElementById('piEmail')?.value || '',
                contact: document.getElementById('contact')?.value || '',
                contactEmail: document.getElementById('contactEmail')?.value || '',
                phone: document.getElementById('phone')?.value || '',
                company: document.getElementById('company')?.value || '',
                building: document.getElementById('building')?.value || '',
                room: document.getElementById('room')?.value || '',
                technician: document.getElementById('technician')?.value || '',
                frequency: document.getElementById('frequency')?.value || 'A',
                invoiceCounter: document.getElementById('invoiceCounter')?.value || '1',
                workOrderNo: document.getElementById('workOrderNo')?.value || '',
                invoiceNo: document.getElementById('invoiceNo')?.value || '',
                serviceDate: document.getElementById('serviceDate')?.value || '',
                nextServiceDue: document.getElementById('nextServiceDue')?.value || '',
                balanceModel: document.getElementById('balanceModel')?.value || '',
                balanceSerial: document.getElementById('balanceSerial')?.value || '',
                balanceCalDue: document.getElementById('balanceCalDue')?.value || ''
            };
        }

        function importFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';

            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const sessionData = JSON.parse(event.target.result);

                        if (!sessionData || !Array.isArray(sessionData.pipettes)) {
                            throw new Error('Invalid file format');
                        }

                        showConfirm("Load this session? Current work will be saved.", "Import Session", () => {
                            autoSave();

                            pipettes = sessionData.pipettes || [];
                            currentPipetteId = sessionData.currentPipetteId || pipettes.length;

                            const sessionInfo = sessionData.sessionInfo || {};
                            Object.keys(sessionInfo).forEach(key => {
                                const element = document.getElementById(key);
                                if (element) {
                                    element.value = sessionInfo[key] || '';
                                }
                            });

                            renderAllPipettes();
                            updateProgress();
                            autoSave();
                            showAlert('Session imported successfully!', 'Success');
                        });
                    } catch (error) {
                        showAlert('Error importing file: ' + error.message, 'Import Error');
                    }
                };
                reader.readAsText(file);
            };

            input.click();
        }

        function generateReport() {
            const reportContent = document.getElementById('reportContent');
            const sessionInfo = getSessionInfo();

            if (pipettes.length === 0) {
                reportContent.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÑ</div>
                        <h3 style="color: #6c757d;">No Data to Display</h3>
                        <p style="color: #adb5bd;">Add pipettes in the Calibration tab to generate a report.</p>
                    </div>
                `;
                return;
            }

            // Calculate summary statistics
            const totalPipettes = pipettes.length;
            const passedPipettes = pipettes.filter(p => p.passFail === 'P').length;
            const failedPipettes = pipettes.filter(p => p.passFail === 'F').length;
            const inSpecCount = pipettes.filter(p => p.inSpec).length;
            const outSpecCount = pipettes.filter(p => p.outSpec).length;
            const adjustmentsCount = pipettes.filter(p =>
                Object.values(p.adjustments).some(v => v === true || (typeof v === 'string' && v !== ''))
            ).length;

            const certNumber = `BC-${new Date(sessionInfo.serviceDate || Date.now()).getFullYear()}-${String(Math.floor(Math.random() * 10000)).padStart(4, '0')}`;

            reportContent.innerHTML = `
                <div style="max-width: 900px; margin: 0 auto; background: white; padding: 40px; border: 1px solid #e9ecef; border-radius: 8px;">

                    <!-- Professional Header -->
                    <div style="border-bottom: 4px solid #223077; padding-bottom: 20px; margin-bottom: 30px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 20px;">
                            <div>
                                <h1 style="color: #223077; font-size: 28px; margin-bottom: 5px;">CALIBRATION INTERNATIONAL INC.</h1>
                                <p style="color: #69B135; font-size: 18px; font-weight: 600; margin: 0;">Basic Calibration Service Report</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #69B135;">
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 5px;">CERTIFICATE NO.</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #223077;">${certNumber}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Executive Summary -->
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: 12px; margin-bottom: 30px; border-left: 5px solid #69B135;">
                        <h2 style="color: #223077; font-size: 20px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            üìä Executive Summary
                        </h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px;">
                            <div style="text-align: center; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                <div style="font-size: 32px; font-weight: bold; color: #223077; margin-bottom: 5px;">${totalPipettes}</div>
                                <div style="font-size: 12px; color: #6c757d; text-transform: uppercase; letter-spacing: 0.5px;">Total Pipettes</div>
                            </div>
                            <div style="text-align: center; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                <div style="font-size: 32px; font-weight: bold; color: #28a745; margin-bottom: 5px;">${passedPipettes}</div>
                                <div style="font-size: 12px; color: #6c757d; text-transform: uppercase; letter-spacing: 0.5px;">Passed</div>
                            </div>
                            <div style="text-align: center; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                <div style="font-size: 32px; font-weight: bold; color: #dc3545; margin-bottom: 5px;">${failedPipettes}</div>
                                <div style="font-size: 12px; color: #6c757d; text-transform: uppercase; letter-spacing: 0.5px;">Failed</div>
                            </div>
                            <div style="text-align: center; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                <div style="font-size: 32px; font-weight: bold; color: #ffc107; margin-bottom: 5px;">${adjustmentsCount}</div>
                                <div style="font-size: 12px; color: #6c757d; text-transform: uppercase; letter-spacing: 0.5px;">Adjustments</div>
                            </div>
                        </div>
                    </div>

                    <!-- Session Information -->
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #223077; font-size: 18px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #e9ecef;">
                            üìã Service Information
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; font-size: 14px;">
                            <div><strong style="color: #223077;">PI:</strong> ${sessionInfo.pi || 'N/A'}</div>
                            <div><strong style="color: #223077;">Contact:</strong> ${sessionInfo.contact || 'N/A'}</div>
                            <div><strong style="color: #223077;">Phone:</strong> ${sessionInfo.phone || 'N/A'}</div>
                            <div><strong style="color: #223077;">Invoice #:</strong> ${sessionInfo.invoiceNo || 'N/A'}</div>
                            <div><strong style="color: #223077;">Company:</strong> ${sessionInfo.company || 'N/A'}</div>
                            <div><strong style="color: #223077;">Technician:</strong> ${sessionInfo.technician || 'N/A'}</div>
                            <div><strong style="color: #223077;">Service Date:</strong> ${sessionInfo.serviceDate ? new Date(sessionInfo.serviceDate).toLocaleDateString() : 'N/A'}</div>
                            <div><strong style="color: #223077;">Next Service Due:</strong> ${sessionInfo.nextServiceDue ? new Date(sessionInfo.nextServiceDue).toLocaleDateString() : 'N/A'}</div>
                        </div>
                    </div>

                    <!-- Balance Information -->
                    <div style="margin-bottom: 30px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                        <h3 style="color: #223077; font-size: 18px; margin-bottom: 15px;">‚öñÔ∏è Balance Information</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; font-size: 14px;">
                            <div><strong style="color: #223077;">Model:</strong> ${sessionInfo.balanceModel || 'N/A'}</div>
                            <div><strong style="color: #223077;">Serial #:</strong> ${sessionInfo.balanceSerial || 'N/A'}</div>
                            <div><strong style="color: #223077;">Cal Due:</strong> ${sessionInfo.balanceCalDue ? new Date(sessionInfo.balanceCalDue).toLocaleDateString() : 'N/A'}</div>
                        </div>
                        <p style="font-size: 12px; color: #6c757d; margin-top: 10px; margin-bottom: 0;">
                            ‚ÑπÔ∏è An Internal Q.C. Calibration check was performed by CALINTL Technician on Balance noted, prior to calibration of pipettes on this date.
                        </p>
                    </div>

                    <!-- Detailed Results Table -->
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #223077; font-size: 18px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #e9ecef;">
                            üî¨ Detailed Calibration Results
                        </h3>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                <thead>
                                    <tr style="background: #223077; color: white;">
                                        <th style="padding: 12px 8px; text-align: left; border: 1px solid #223077;">No.</th>
                                        <th style="padding: 12px 8px; text-align: left; border: 1px solid #223077;">Manufacturer/Model</th>
                                        <th style="padding: 12px 8px; text-align: center; border: 1px solid #223077;">Vol (¬µL)</th>
                                        <th style="padding: 12px 8px; text-align: center; border: 1px solid #223077;">Spec</th>
                                        <th style="padding: 12px 8px; text-align: left; border: 1px solid #223077;">Adjustments</th>
                                        <th style="padding: 12px 8px; text-align: left; border: 1px solid #223077;">Final Volumes (¬µL)</th>
                                        <th style="padding: 12px 8px; text-align: center; border: 1px solid #223077;">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${pipettes.map((p, index) => {
                                        const adjustments = Object.entries(p.adjustments)
                                            .filter(([key, val]) => val === true || (key === 'OTHER' && val !== ''))
                                            .map(([key, val]) => key === 'OTHER' ? val : key)
                                            .join(', ') || '--';

                                        const volumes = p.finalVolumes.filter(v => v !== '').join(', ') || '--';
                                        const specStatus = p.inSpec ? '‚úì In' : (p.outSpec ? '‚úó Out' : '--');
                                        const bgColor = index % 2 === 0 ? '#ffffff' : '#f8f9fa';

                                        return `
                                            <tr style="background: ${bgColor};">
                                                <td style="padding: 10px 8px; border: 1px solid #e9ecef;"><strong>${p.number}</strong></td>
                                                <td style="padding: 10px 8px; border: 1px solid #e9ecef;">${p.manufacturer || '--'} ${p.model || ''}</td>
                                                <td style="padding: 10px 8px; text-align: center; border: 1px solid #e9ecef;">${p.maxVolume || '--'}</td>
                                                <td style="padding: 10px 8px; text-align: center; border: 1px solid #e9ecef; color: ${p.inSpec ? '#28a745' : (p.outSpec ? '#dc3545' : '#6c757d')};">
                                                    ${specStatus}
                                                </td>
                                                <td style="padding: 10px 8px; border: 1px solid #e9ecef; font-size: 11px;">${adjustments}</td>
                                                <td style="padding: 10px 8px; border: 1px solid #e9ecef; font-size: 11px;">${volumes}</td>
                                                <td style="padding: 10px 8px; text-align: center; border: 1px solid #e9ecef;">
                                                    ${p.passFail ? `
                                                        <span style="display: inline-block; padding: 4px 12px; border-radius: 12px; font-weight: 600; font-size: 11px;
                                                                     background: ${p.passFail === 'P' ? '#d4edda' : '#f8d7da'};
                                                                     color: ${p.passFail === 'P' ? '#155724' : '#721c24'};">
                                                            ${p.passFail === 'P' ? '‚úì PASS' : '‚úó FAIL'}
                                                        </span>
                                                    ` : '--'}
                                                </td>
                                            </tr>
                                            ${p.comments ? `
                                                <tr style="background: ${bgColor};">
                                                    <td colspan="7" style="padding: 8px; border: 1px solid #e9ecef; font-size: 12px; color: #6c757d;">
                                                        <strong>Note:</strong> ${p.comments}
                                                    </td>
                                                </tr>
                                            ` : ''}
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Adjustments Legend -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                        <h4 style="color: #223077; font-size: 14px; margin-bottom: 10px;">Adjustments & Repairs Legend:</h4>
                        <p style="font-size: 12px; color: #32373c; line-height: 1.6; margin: 0;">
                            <strong>SE</strong> = Seal Replacement |
                            <strong>COR</strong> = Corrosion |
                            <strong>G</strong> = Grease |
                            <strong>SH</strong> = Shaft |
                            <strong>FR</strong> = Friction Ring |
                            <strong>O</strong> = O-Ring
                        </p>
                    </div>

                    <!-- Certification Footer -->
                    <div style="border-top: 3px solid #69B135; padding-top: 20px; margin-top: 40px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <p style="font-size: 12px; color: #6c757d; margin-bottom: 5px;">Verified By:</p>
                                <div style="border-bottom: 2px solid #223077; padding-bottom: 5px; margin-bottom: 20px;">
                                    <strong style="color: #223077;">${sessionInfo.technician || '__________________'}</strong>
                                </div>
                            </div>
                            <div>
                                <p style="font-size: 12px; color: #6c757d; margin-bottom: 5px;">Date:</p>
                                <div style="border-bottom: 2px solid #223077; padding-bottom: 5px; margin-bottom: 20px;">
                                    <strong style="color: #223077;">${sessionInfo.serviceDate ? new Date(sessionInfo.serviceDate).toLocaleDateString() : '__________'}</strong>
                                </div>
                            </div>
                        </div>

                        <div style="background: #e7f3ff; border-left: 4px solid #0066cc; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                            <p style="font-size: 11px; color: #004080; margin: 0; line-height: 1.5;">
                                <strong>ISO 8655-2:2002 Compliance:</strong> CALINTL Technician calibrated pipettes to meet ISO 8655-2:2002 standards.
                                Balance Calibration Certificate indicating NIST Traceable available upon request.
                            </p>
                        </div>

                        <div style="text-align: center; padding-top: 10px; border-top: 1px solid #e9ecef;">
                            <p style="font-size: 11px; color: #6c757d; margin: 0;">
                                <strong>CALIBRATIONS INTERNATIONAL INC.</strong><br>
                                2142 Chipset Street, Bozeman, Montana 59718<br>
                                Phone: 406-589-6025 | Toll Free: 1-877-225-4685<br>
                                theresa@calibrationsinternational.com
                            </p>
                        </div>
                    </div>

                </div>
            `;
        }

        function exportToCSV() {
            if (pipettes.length === 0) {
                showAlert('No pipettes to export.', 'Export CSV');
                return;
            }

            const sessionInfo = getSessionInfo();
            let csv = 'CALIBRATIONS INTERNATIONAL INC. - BASIC CALIBRATION SERVICE\n';
            csv += `Date: ${sessionInfo.serviceDate || new Date().toLocaleDateString()}\n`;
            csv += `Technician: ${sessionInfo.technician}\n`;
            csv += `Balance: ${sessionInfo.balanceModel} SN: ${sessionInfo.balanceSerial}\n\n`;

            csv += 'No.,Manufacturer,Model,Max Vol,In Spec,Out Spec,Adjustments,Sample 1,Sample 2,Sample 3,Sample 4,Pass/Fail,Comments\n';

            pipettes.forEach(p => {
                const adjustments = Object.entries(p.adjustments)
                    .filter(([key, val]) => val === true || (key === 'OTHER' && val !== ''))
                    .map(([key, val]) => key === 'OTHER' ? val : key)
                    .join('; ');

                csv += [
                    p.number,
                    p.manufacturer,
                    p.model,
                    p.maxVolume,
                    p.inSpec ? 'Yes' : 'No',
                    p.outSpec ? 'Yes' : 'No',
                    adjustments,
                    p.finalVolumes[0] || '',
                    p.finalVolumes[1] || '',
                    p.finalVolumes[2] || '',
                    p.finalVolumes[3] || '',
                    p.passFail,
                    p.comments
                ].map(val => `"${val}"`).join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `basic_calibration_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            showAlert('CSV exported successfully!', 'Success');
        }

        // ============================================================
        // BARCODE SCANNER FUNCTIONS
        // ============================================================

        // Show scan success feedback
        function showScanFeedback(field, value) {
            // Visual feedback - green flash
            field.classList.add('scan-success');
            setTimeout(() => field.classList.remove('scan-success'), 600);

            // Update scan counter
            barcodeScansToday++;
            updateScanCounter();

            // Status message
            const statusDiv = document.getElementById('scan-status');
            if (statusDiv) {
                statusDiv.textContent = `‚úÖ Scanned: ${value}`;
                statusDiv.style.color = '#28a745';
                setTimeout(() => {
                    statusDiv.textContent = '';
                }, 3000);
            }

            // Optional: Play beep sound (commented out - can enable if desired)
            // playBeep();
        }

        // Update scan counter display
        function updateScanCounter() {
            const counterDiv = document.getElementById('scan-counter');
            if (counterDiv) {
                counterDiv.textContent = `üìä ${barcodeScansToday} scan${barcodeScansToday !== 1 ? 's' : ''} today`;
            }
        }

        // Auto-advance to next field after barcode scan
        function autoAdvanceAfterScan(currentField) {
            // Determine which field was scanned
            const fieldId = currentField.id;

            // If it's a serial number field
            if (fieldId.startsWith('serial-')) {
                const pipetteId = fieldId.replace('serial-', '');

                // Try to focus on make/model field
                const makeModelField = document.getElementById(`makeModel-${pipetteId}`);
                if (makeModelField) {
                    setTimeout(() => {
                        makeModelField.focus();
                        makeModelField.select();
                    }, 100);
                    return;
                }

                // If make/model already filled, focus on max volume
                const maxVolumeField = document.getElementById(`maxVolume-${pipetteId}`);
                if (maxVolumeField) {
                    setTimeout(() => {
                        maxVolumeField.focus();
                        maxVolumeField.select();
                    }, 100);
                    return;
                }
            }

            // Default: try to focus next input field
            const allInputs = Array.from(document.querySelectorAll('input[type="text"], input[type="number"], select'));
            const currentIndex = allInputs.indexOf(currentField);
            if (currentIndex >= 0 && currentIndex < allInputs.length - 1) {
                setTimeout(() => {
                    allInputs[currentIndex + 1].focus();
                }, 100);
            }
        }

        // Optional: Play beep sound
        function playBeep() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 1000; // 1000Hz beep
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkPassword()) {
                return;
            }

            // Set up modal event listeners
            document.getElementById('customModal')?.addEventListener('click', (e) => {
                if (e.target.id === 'customModal') closeModal();
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && document.getElementById('customModal')?.style.display === 'flex') {
                    closeModal();
                }

                // ========================================
                // BARCODE SCANNER DETECTION
                // ========================================
                // Detect rapid keystrokes from barcode scanner
                // Scanners type much faster than humans (<50ms between keys)

                const now = Date.now();
                const timeSinceLastKey = now - lastKeyTime;
                const isInputField = ['INPUT', 'TEXTAREA'].includes(e.target.tagName);

                // Only detect barcodes in text input fields
                if (isInputField && e.target.type === 'text') {
                    // Rapid keystrokes indicate barcode scanner
                    if (timeSinceLastKey < BARCODE_SCAN_SPEED_MS && timeSinceLastKey > 0) {
                        // Scanner is typing
                        barcodeBuffer += e.key;
                    } else {
                        // Human typing or new scan starting
                        barcodeBuffer = e.key;
                    }

                    lastKeyTime = now;

                    // Enter key signals end of barcode scan
                    if (e.key === 'Enter' && barcodeBuffer.length > 3) {
                        e.preventDefault(); // Prevent form submission

                        // Remove 'Enter' from buffer
                        const scannedValue = barcodeBuffer.slice(0, -5).trim();

                        // Show visual feedback
                        showScanFeedback(e.target, scannedValue);

                        // Auto-advance to next field
                        autoAdvanceAfterScan(e.target);

                        // Clear buffer
                        barcodeBuffer = '';
                        return;
                    }
                }

                // ========================================
                // KEYBOARD SHORTCUTS
                // ========================================
                // Keyboard shortcuts (Ctrl/Cmd + key)
                if ((e.ctrlKey || e.metaKey) && !e.shiftKey && !e.altKey) {
                    // Ignore if typing in an input/textarea (except Ctrl+S for save)
                    const isInputField = ['INPUT', 'TEXTAREA', 'SELECT'].includes(e.target.tagName);

                    switch(e.key.toLowerCase()) {
                        case 'n':
                            // Ctrl+N: Add new pipette
                            if (!isInputField) {
                                e.preventDefault();
                                addPipette();
                            }
                            break;
                        case 's':
                            // Ctrl+S: Save/export session
                            e.preventDefault();
                            exportToFile();
                            break;
                        case 'd':
                            // Ctrl+D: Duplicate (copy from previous)
                            if (!isInputField) {
                                e.preventDefault();
                                copyFromPrevious();
                            }
                            break;
                    }
                }
            });

            // Load saved session
            const sessionLoaded = loadCurrentSession();

            // Set default dates if no session
            if (!sessionLoaded) {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('serviceDate').value = today;

                const nextYear = new Date();
                nextYear.setFullYear(nextYear.getFullYear() + 1);
                document.getElementById('nextServiceDue').value = nextYear.toISOString().split('T')[0];

                const nextMonth = new Date();
                nextMonth.setMonth(nextMonth.getMonth() + 1);
                document.getElementById('balanceCalDue').value = nextMonth.toISOString().split('T')[0];

                // Load inventory usage even if no session
                loadInventoryUsage();
            }

            // Setup autofill for common fields
            setupAutofill();

            // Generate work order and invoice if fields are filled
            if (sessionLoaded) {
                generateWorkOrderAndInvoice();
            }

            // Check if backup reminder should be shown
            checkBackupReminder();

            // Load session history
            loadHistory();

            // Add autosave listeners to form fields
            document.querySelectorAll('#session input, #session select').forEach(input => {
                input.addEventListener('change', debouncedAutoSave);
            });

            // Add click listener for inventory modal
            document.getElementById('addInventoryModal')?.addEventListener('click', (e) => {
                if (e.target.id === 'addInventoryModal') {
                    closeInventoryModal();
                }
            });

            console.log('Basic Calibration System initialized');
        });

        // ========================================
        // SESSION HISTORY
        // ========================================

        function loadHistory() {
            const sessions = JSON.parse(localStorage.getItem('basicCalSessions') || '[]');
            const historyContainer = document.getElementById('historyContainer');

            if (sessions.length === 0) {
                historyContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <h3 style="color: #6c757d;">No Previous Sessions</h3>
                        <p style="color: #adb5bd;">Your saved calibration sessions will appear here.</p>
                    </div>
                `;
                return;
            }

            historyContainer.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <p style="color: #6c757d; font-size: 14px;">
                        Found ${sessions.length} saved session${sessions.length > 1 ? 's' : ''}. Click any session to load it.
                    </p>
                </div>
                <div style="display: grid; gap: 15px;">
                    ${sessions.map((session, index) => {
                        const date = new Date(session.lastModified || session.timestamp);
                        const pipetteCount = session.pipettes?.length || 0;
                        const passCount = session.pipettes?.filter(p => p.passFail === 'P').length || 0;
                        const failCount = session.pipettes?.filter(p => p.passFail === 'F').length || 0;

                        return `
                            <div style="background: white; border: 2px solid #e9ecef; border-radius: 8px; padding: 20px; cursor: pointer; transition: all 0.3s ease;"
                                 onmouseover="this.style.borderColor='#69B135'; this.style.boxShadow='0 4px 12px rgba(105,177,53,0.2)'"
                                 onmouseout="this.style.borderColor='#e9ecef'; this.style.boxShadow='none'"
                                 onclick="loadSessionFromHistory('${session.id}')">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                    <div>
                                        <h3 style="color: #223077; font-size: 16px; margin-bottom: 5px;">
                                            ${session.sessionInfo?.sessionName || session.sessionInfo?.company || session.sessionInfo?.pi || `Session ${index + 1}`}
                                        </h3>
                                        <p style="color: #6c757d; font-size: 13px; margin: 0;">
                                            ${date.toLocaleString()}
                                        </p>
                                    </div>
                                    <button onclick="event.stopPropagation(); deleteSession('${session.id}')"
                                            class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;">
                                        üóëÔ∏è Delete
                                    </button>
                                </div>
                                <div style="display: flex; gap: 15px; flex-wrap: wrap; font-size: 13px;">
                                    <div style="background: #f8f9fa; padding: 8px 12px; border-radius: 6px;">
                                        <strong style="color: #223077;">${pipetteCount}</strong> Pipettes
                                    </div>
                                    ${passCount > 0 ? `
                                        <div style="background: #d4edda; padding: 8px 12px; border-radius: 6px; color: #155724;">
                                            <strong>${passCount}</strong> Passed
                                        </div>
                                    ` : ''}
                                    ${failCount > 0 ? `
                                        <div style="background: #f8d7da; padding: 8px 12px; border-radius: 6px; color: #721c24;">
                                            <strong>${failCount}</strong> Failed
                                        </div>
                                    ` : ''}
                                    ${session.sessionInfo?.technician ? `
                                        <div style="background: #e7f3ff; padding: 8px 12px; border-radius: 6px; color: #004080;">
                                            Tech: <strong>${session.sessionInfo.technician}</strong>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function loadSessionFromHistory(sessionId) {
            const sessions = JSON.parse(localStorage.getItem('basicCalSessions') || '[]');
            const session = sessions.find(s => s.id === sessionId);

            if (!session) {
                showAlert('Session not found.', 'Error');
                return;
            }

            showConfirm("Load this session? Current work will be saved.", "Load Session", () => {
                autoSave();

                currentSessionId = session.id;
                pipettes = session.pipettes || [];
                currentPipetteId = session.currentPipetteId || 0;

                const sessionInfo = session.sessionInfo || {};
                Object.keys(sessionInfo).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = sessionInfo[key] || '';
                    }
                });

                renderAllPipettes();
                updateProgress();
                autoSave();

                // Switch to calibration tab
                showTab('calibration', document.querySelectorAll('.nav-tab')[1]);

                showAlert('Session loaded successfully!', 'Success');
            });
        }

        function deleteSession(sessionId) {
            showConfirm("Delete this session permanently?", "Confirm Delete", () => {
                let sessions = JSON.parse(localStorage.getItem('basicCalSessions') || '[]');
                sessions = sessions.filter(s => s.id !== sessionId);
                localStorage.setItem('basicCalSessions', JSON.stringify(sessions));

                // Reload history
                loadHistory();

                showAlert('Session deleted.', 'Deleted');
            });
        }

        // ============================================================
        // DYMO LABEL PRINTING FUNCTIONS
        // ============================================================

        let dymoAvailable = false;
        let dymoPrinters = [];

        // Check if DYMO Connect service is running
        async function checkDymoService() {
            const statusDiv = document.getElementById('printerStatus');
            const infoDiv = document.getElementById('printerInfo');
            const instructionsDiv = document.getElementById('dymoInstructions');

            statusDiv.innerHTML = 'üîÑ Checking...';
            infoDiv.innerHTML = '';

            try {
                const response = await fetch('http://127.0.0.1:41951/DYMO/DLS/Printing/StatusConnected', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });

                if (response.ok) {
                    const isConnected = await response.text();
                    if (isConnected === 'true') {
                        dymoAvailable = true;
                        statusDiv.innerHTML = '‚úÖ <span style="color: #28a745; font-weight: 600;">DYMO Connect Running</span>';
                        instructionsDiv.style.display = 'none';
                        await getDymoPrinters();
                    } else {
                        throw new Error('Not connected');
                    }
                } else {
                    throw new Error('Service not available');
                }
            } catch (error) {
                dymoAvailable = false;
                statusDiv.innerHTML = '‚ùå <span style="color: #dc3545; font-weight: 600;">DYMO Connect Not Running</span>';
                infoDiv.innerHTML = '';
                instructionsDiv.style.display = 'block';
            }
        }

        // Get available DYMO printers
        async function getDymoPrinters() {
            const infoDiv = document.getElementById('printerInfo');

            try {
                const response = await fetch('http://127.0.0.1:41951/DYMO/DLS/Printing/GetPrinters', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });

                if (response.ok) {
                    const printers = await response.json();
                    dymoPrinters = printers;

                    if (printers && printers.length > 0) {
                        const labelWriters = printers.filter(p => p.name.includes('LabelWriter') || p.name.includes('450'));
                        if (labelWriters.length > 0) {
                            infoDiv.innerHTML = `üìü Found: <strong>${labelWriters[0].name}</strong>`;
                            infoDiv.style.color = '#28a745';
                        } else {
                            infoDiv.innerHTML = '‚ö†Ô∏è No LabelWriter 450 detected. Printers found: ' + printers.map(p => p.name).join(', ');
                            infoDiv.style.color = '#ffc107';
                        }
                    } else {
                        infoDiv.innerHTML = '‚ö†Ô∏è No printers detected. Make sure your LabelWriter 450 is connected and turned on.';
                        infoDiv.style.color = '#ffc107';
                    }
                }
            } catch (error) {
                infoDiv.innerHTML = '‚ùå Could not retrieve printer list: ' + error.message;
                infoDiv.style.color = '#dc3545';
            }
        }

        // Create basic 1x1 label XML template
        function createLabelXML(serialNumber, volume, status) {
            const qrData = `SN:${serialNumber}|VOL:${volume}`;

            // Basic 1x1 inch label template (DYMO 30334 size)
            return `<?xml version="1.0" encoding="utf-8"?>
<DieCutLabel Version="8.0" Units="twips">
    <PaperOrientation>Landscape</PaperOrientation>
    <Id>Small30334</Id>
    <PaperName>30334 2-1/4 in x 1-1/4 in</PaperName>
    <DrawCommands>
        <RoundRectangle X="0" Y="0" Width="1440" Height="1800" Rx="0" Ry="0"/>
    </DrawCommands>
    <ObjectInfo>
        <TextObject>
            <Name>TEXT_SERIAL</Name>
            <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>
            <BackColor Alpha="0" Red="255" Green="255" Blue="255"/>
            <LinkedObjectName></LinkedObjectName>
            <Rotation>Rotation0</Rotation>
            <IsMirrored>False</IsMirrored>
            <IsVariable>True</IsVariable>
            <HorizontalAlignment>Center</HorizontalAlignment>
            <VerticalAlignment>Middle</VerticalAlignment>
            <TextFitMode>ShrinkToFit</TextFitMode>
            <UseFullFontHeight>True</UseFullFontHeight>
            <Verticalized>False</Verticalized>
            <StyledText>
                <Element>
                    <String>${serialNumber}</String>
                    <Attributes>
                        <Font Family="Arial" Size="10" Bold="True" Italic="False" Underline="False" Strikeout="False"/>
                        <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>
                    </Attributes>
                </Element>
            </StyledText>
        </TextObject>
        <Bounds X="360" Y="1200" Width="1080" Height="300"/>
    </ObjectInfo>
    <ObjectInfo>
        <TextObject>
            <Name>TEXT_VOLUME</Name>
            <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>
            <BackColor Alpha="0" Red="255" Green="255" Blue="255"/>
            <LinkedObjectName></LinkedObjectName>
            <Rotation>Rotation0</Rotation>
            <IsMirrored>False</IsMirrored>
            <IsVariable>True</IsVariable>
            <HorizontalAlignment>Center</HorizontalAlignment>
            <VerticalAlignment>Middle</VerticalAlignment>
            <TextFitMode>ShrinkToFit</TextFitMode>
            <UseFullFontHeight>True</UseFullFontHeight>
            <Verticalized>False</Verticalized>
            <StyledText>
                <Element>
                    <String>${volume}</String>
                    <Attributes>
                        <Font Family="Arial" Size="8" Bold="False" Italic="False" Underline="False" Strikeout="False"/>
                        <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>
                    </Attributes>
                </Element>
            </StyledText>
        </TextObject>
        <Bounds X="360" Y="1500" Width="1080" Height="250"/>
    </ObjectInfo>
    <ObjectInfo>
        <TextObject>
            <Name>TEXT_STATUS</Name>
            <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>
            <BackColor Alpha="0" Red="255" Green="255" Blue="255"/>
            <LinkedObjectName></LinkedObjectName>
            <Rotation>Rotation0</Rotation>
            <IsMirrored>False</IsMirrored>
            <IsVariable>True</IsVariable>
            <HorizontalAlignment>Center</HorizontalAlignment>
            <VerticalAlignment>Middle</VerticalAlignment>
            <TextFitMode>ShrinkToFit</TextFitMode>
            <UseFullFontHeight>True</UseFullFontHeight>
            <Verticalized>False</Verticalized>
            <StyledText>
                <Element>
                    <String>${status === 'P' ? '‚úì PASS' : status === 'F' ? '‚úó FAIL' : 'N/A'}</String>
                    <Attributes>
                        <Font Family="Arial" Size="8" Bold="True" Italic="False" Underline="False" Strikeout="False"/>
                        <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>
                    </Attributes>
                </Element>
            </StyledText>
        </TextObject>
        <Bounds X="360" Y="300" Width="1080" Height="250"/>
    </ObjectInfo>
    <ObjectInfo>
        <BarcodeObject>
            <Name>BARCODE_QR</Name>
            <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>
            <BackColor Alpha="0" Red="255" Green="255" Blue="255"/>
            <LinkedObjectName></LinkedObjectName>
            <Rotation>Rotation0</Rotation>
            <IsMirrored>False</IsMirrored>
            <IsVariable>True</IsVariable>
            <Text>${qrData}</Text>
            <Type>QRCode</Type>
            <Size>Small</Size>
            <TextPosition>None</TextPosition>
            <TextFont Family="Arial" Size="8" Bold="False" Italic="False" Underline="False" Strikeout="False"/>
            <CheckSumFont Family="Arial" Size="8" Bold="False" Italic="False" Underline="False" Strikeout="False"/>
            <TextEmbedding>None</TextEmbedding>
            <ECLevel>0</ECLevel>
            <HorizontalAlignment>Center</HorizontalAlignment>
            <QuietZonesPadding Left="0" Right="0" Top="0" Bottom="0"/>
        </BarcodeObject>
        <Bounds X="60" Y="300" Width="900" Height="900"/>
    </ObjectInfo>
</DieCutLabel>`;
        }

        // Render pipette checkboxes for label selection
        function renderLabelPipetteList() {
            const container = document.getElementById('labelPipetteList');

            if (pipettes.length === 0) {
                container.innerHTML = '<p style="color: #6c757d; text-align: center; padding: 40px;">No pipettes added yet. Go to the Calibration tab to add pipettes.</p>';
                return;
            }

            let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';

            pipettes.forEach(p => {
                const volume = p.volume || 'N/A';
                const serial = p.serialNumber || 'N/A';
                const status = p.passFail || 'N/A';
                const statusIcon = status === 'P' ? '‚úÖ PASS' : status === 'F' ? '‚ùå FAIL' : '‚ö™ N/A';

                html += `
                    <div style="display: flex; align-items: center; padding: 12px; background: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
                        <input type="checkbox" id="labelCheck-${p.id}" class="label-checkbox"
                               style="width: 20px; height: 20px; margin-right: 15px; cursor: pointer;"
                               onchange="updateLabelPreview()">
                        <label for="labelCheck-${p.id}" style="flex: 1; cursor: pointer; margin: 0; display: flex; align-items: center; gap: 15px;">
                            <span style="font-weight: 600; color: #223077;">Pipette #${p.number}</span>
                            <span style="color: #495057;">SN: ${serial}</span>
                            <span style="color: #495057;">${volume}</span>
                            <span>${statusIcon}</span>
                        </label>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        // Select all pipettes for labeling
        function selectAllLabels() {
            document.querySelectorAll('.label-checkbox').forEach(cb => cb.checked = true);
            updateLabelPreview();
        }

        // Deselect all pipettes
        function deselectAllLabels() {
            document.querySelectorAll('.label-checkbox').forEach(cb => cb.checked = false);
            updateLabelPreview();
        }

        // Update label preview when selection changes
        function updateLabelPreview() {
            const previewDiv = document.getElementById('labelPreview');
            const selected = getSelectedPipettesForLabels();

            if (selected.length === 0) {
                previewDiv.innerHTML = '<p style="color: #6c757d;">Select a pipette to preview its label</p>';
                return;
            }

            // Preview first selected pipette
            const p = selected[0];
            const volume = p.volume || 'N/A';
            const serial = p.serialNumber || 'N/A';
            const status = p.passFail || 'N/A';
            const statusText = status === 'P' ? '‚úì PASS' : status === 'F' ? '‚úó FAIL' : 'N/A';

            // Generate QR code using qrcode.js
            const qrData = `SN:${serial}|VOL:${volume}`;

            previewDiv.innerHTML = `
                <div style="background: white; padding: 20px; border: 2px dashed #223077; border-radius: 8px; text-align: center; width: 200px;">
                    <div id="qrcode-preview" style="margin: 0 auto 15px auto;"></div>
                    <div style="font-weight: 600; font-size: 14px; margin-bottom: 5px;">${serial}</div>
                    <div style="font-size: 12px; color: #495057; margin-bottom: 5px;">${volume}</div>
                    <div style="font-size: 12px; font-weight: 600; color: ${status === 'P' ? '#28a745' : status === 'F' ? '#dc3545' : '#6c757d'};">${statusText}</div>
                    ${selected.length > 1 ? `<div style="margin-top: 15px; padding: 8px; background: #e7f3ff; border-radius: 4px; font-size: 12px; color: #004085;">+${selected.length - 1} more label${selected.length > 2 ? 's' : ''}</div>` : ''}
                </div>
            `;

            // Generate QR code (we'll add the library via CDN in the head section)
            if (typeof QRCode !== 'undefined') {
                new QRCode(document.getElementById('qrcode-preview'), {
                    text: qrData,
                    width: 100,
                    height: 100
                });
            } else {
                document.getElementById('qrcode-preview').innerHTML = '<div style="width: 100px; height: 100px; background: #dee2e6; display: flex; align-items: center; justify-content: center; margin: 0 auto; font-size: 10px; color: #6c757d;">QR Code</div>';
            }
        }

        // Get selected pipettes for label printing
        function getSelectedPipettesForLabels() {
            const selected = [];
            document.querySelectorAll('.label-checkbox:checked').forEach(cb => {
                const pipetteId = cb.id.replace('labelCheck-', '');
                const pipette = pipettes.find(p => p.id === pipetteId);
                if (pipette) selected.push(pipette);
            });
            return selected;
        }

        // Print selected labels
        async function printSelectedLabels() {
            const statusDiv = document.getElementById('printStatus');
            const selected = getSelectedPipettesForLabels();

            if (selected.length === 0) {
                statusDiv.innerHTML = '<span style="color: #ffc107;">‚ö†Ô∏è Please select at least one pipette</span>';
                return;
            }

            if (!dymoAvailable) {
                statusDiv.innerHTML = '<span style="color: #dc3545;">‚ùå DYMO Connect not running. Click Refresh above.</span>';
                return;
            }

            const copies = parseInt(document.getElementById('labelCopies').value) || 1;
            statusDiv.innerHTML = `<span style="color: #007bff;">üñ®Ô∏è Printing ${selected.length} label(s) √ó ${copies} cop${copies > 1 ? 'ies' : 'y'}...</span>`;

            let successCount = 0;
            let failCount = 0;

            for (const p of selected) {
                const volume = p.volume || 'N/A';
                const serial = p.serialNumber || 'N/A';
                const status = p.passFail || 'N/A';

                const labelXML = createLabelXML(serial, volume, status);

                try {
                    // Get printer name
                    let printerName = '';
                    if (dymoPrinters && dymoPrinters.length > 0) {
                        const labelWriter = dymoPrinters.find(p => p.name.includes('LabelWriter') || p.name.includes('450'));
                        printerName = labelWriter ? labelWriter.name : dymoPrinters[0].name;
                    }

                    // Print label
                    const response = await fetch('http://127.0.0.1:41951/DYMO/DLS/Printing/PrintLabel', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: `printerName=${encodeURIComponent(printerName)}&printParamsXml=&labelXml=${encodeURIComponent(labelXML)}&labelSetXml=`
                    });

                    if (response.ok) {
                        // Print additional copies if requested
                        for (let i = 1; i < copies; i++) {
                            await fetch('http://127.0.0.1:41951/DYMO/DLS/Printing/PrintLabel', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                                body: `printerName=${encodeURIComponent(printerName)}&printParamsXml=&labelXml=${encodeURIComponent(labelXML)}&labelSetXml=`
                            });
                        }
                        successCount++;
                    } else {
                        failCount++;
                        console.error('Print failed for pipette', p.number, response.statusText);
                    }
                } catch (error) {
                    failCount++;
                    console.error('Print error for pipette', p.number, error);
                }

                // Small delay between prints
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            if (failCount === 0) {
                statusDiv.innerHTML = `<span style="color: #28a745;">‚úÖ Successfully printed ${successCount} label(s)!</span>`;
            } else {
                statusDiv.innerHTML = `<span style="color: #ffc107;">‚ö†Ô∏è Printed ${successCount}, Failed ${failCount}</span>`;
            }

            // Clear status after 5 seconds
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 5000);
        }

        // Initialize labels tab when navigating to it
        function initLabelsTab() {
            checkDymoService();
            renderLabelPipetteList();
        }
    </script>
    </script>

    <div class="container">
        <div class="header">
            <h1>üî¨ Basic Calibration Service</h1>
            <p>CALIBRATIONS INTERNATIONAL INC. | ISO 8655-2:2002 Compliant</p>
            <div class="controls">
                <button id="undoBtn" onclick="undo()" disabled title="Nothing to undo" class="btn btn-secondary">‚Ü∂ Undo</button>
                <button id="redoBtn" onclick="redo()" disabled title="Nothing to redo" class="btn btn-secondary">‚Ü∑ Redo</button>
                <button onclick="logout()" class="btn btn-danger">üîí Logout</button>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('session', this)">üìã Session Info</button>
            <button class="nav-tab" onclick="showTab('calibration', this)">üîß Calibration</button>
            <button class="nav-tab" onclick="showTab('summary', this)">üìä Summary Table</button>
            <button class="nav-tab" onclick="showTab('report', this)">üìÑ Report</button>
            <button class="nav-tab" onclick="showTab('labels', this)">üè∑Ô∏è Labels</button>
            <button class="nav-tab" onclick="showTab('inventory', this)">üì¶ Inventory Used</button>
            <button class="nav-tab" onclick="showTab('history', this)">üìö History</button>
        </div>

        <!-- Session Info Tab -->
        <div id="session" class="tab-content active">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: #223077;">üìã Session Information</h2>
                <div>
                    <button class="btn btn-primary" onclick="newSession()">üÜï New Session</button>
                    <button class="btn btn-secondary" onclick="importFromFile()">üì• Import</button>
                </div>
            </div>

            <!-- Session Name -->
            <div style="margin-bottom: 25px;">
                <label style="font-weight: 600; color: #223077; display: block; margin-bottom: 8px;">Session Name</label>
                <input type="text" id="sessionName" placeholder="e.g., Lab 204 Monthly Cal - Dec 2024"
                       style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 6px; font-size: 15px;"
                       onchange="debouncedAutoSave()">
                <p style="font-size: 12px; color: #6c757d; margin-top: 5px;">Give this session a memorable name for easy identification in history</p>
            </div>

            <!-- Client Information Card -->
            <div class="form-section-card">
                <h3 class="form-section-header">
                    <span>üìã</span>
                    <span>Client & Service Information</span>
                </h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Principal Investigator</label>
                        <input type="text" id="pi" placeholder="PI Name" onchange="generateWorkOrderAndInvoice()">
                    </div>
                    <div class="form-group">
                        <label>PI Email</label>
                        <input type="email" id="piEmail" placeholder="PI Email">
                    </div>
                    <div class="form-group">
                        <label>Contact Person</label>
                        <input type="text" id="contact" placeholder="Contact Name">
                    </div>
                    <div class="form-group">
                        <label>Contact Email</label>
                        <input type="email" id="contactEmail" placeholder="Contact Email">
                    </div>
                    <div class="form-group">
                        <label>Phone for Billing</label>
                        <input type="tel" id="phone" placeholder="Phone Number">
                    </div>
                    <div class="form-group">
                        <label>Company/University</label>
                        <input type="text" id="company" placeholder="Company/University">
                    </div>
                    <div class="form-group">
                        <label>Building</label>
                        <input type="text" id="building" placeholder="Building Name/Number">
                    </div>
                    <div class="form-group">
                        <label>Room #</label>
                        <input type="text" id="room" placeholder="Room Number">
                    </div>
                </div>
            </div>

            <!-- Service Details Card -->
            <div class="form-section-card">
                <h3 class="form-section-header">
                    <span>üîß</span>
                    <span>Service Details</span>
                </h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Technician</label>
                        <input type="text" id="technician" value="TSD" list="technicianList" onchange="generateWorkOrderAndInvoice()">
                    </div>
                    <div class="form-group">
                        <label>Frequency</label>
                        <select id="frequency" onchange="generateWorkOrderAndInvoice()">
                            <option value="A" selected>Annual</option>
                            <option value="B">Biannual</option>
                            <option value="S">Semi-Annual</option>
                            <option value="Q">Quarterly</option>
                            <option value="M">Monthly</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Date of Service</label>
                        <input type="date" id="serviceDate" onchange="generateWorkOrderAndInvoice()">
                    </div>
                    <div class="form-group">
                        <label>Next Service Due</label>
                        <input type="date" id="nextServiceDue">
                    </div>
                    <div class="form-group">
                        <label>Invoice # of Day</label>
                        <input type="number" id="invoiceCounter" value="1" min="1" onchange="generateWorkOrderAndInvoice()"
                               style="width: 100px;" placeholder="1">
                        <p style="font-size: 11px; color: #6c757d; margin-top: 3px;">1st, 2nd, 3rd invoice of the day</p>
                    </div>
                    <div class="form-group">
                        <label>Work Order Number</label>
                        <input type="text" id="workOrderNo" placeholder="Auto-generated" readonly style="background: #fff;">
                    </div>
                    <div class="form-group">
                        <label>Invoice Number</label>
                        <input type="text" id="invoiceNo" placeholder="Auto-generated" readonly style="background: #fff;">
                    </div>
                </div>
            </div>

            <!-- Balance Information Card -->
            <div class="form-section-card">
                <h3 class="form-section-header">
                    <span>‚öñÔ∏è</span>
                    <span>Balance Calibration Information</span>
                </h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Balance Model</label>
                        <input type="text" id="balanceModel" value="XS105DU">
                    </div>
                    <div class="form-group">
                        <label>Balance Serial Number</label>
                        <input type="text" id="balanceSerial" value="B621501811">
                    </div>
                    <div class="form-group">
                        <label>Balance Cal Due Date</label>
                        <input type="date" id="balanceCalDue">
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="showTab('calibration', document.querySelectorAll('.nav-tab')[1])" style="margin-top: 20px;">
                Next: Start Calibration ‚Üí
            </button>
        </div>

        <!-- Calibration Tab -->
        <div id="calibration" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h2 style="color: #223077;">üîß Pipette Calibration</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="copyFromPrevious()" title="Copy configuration from last pipette (Ctrl+D)">üìã Copy from Previous</button>
                    <button class="btn btn-primary" onclick="addPipette()" title="Add new pipette (Ctrl+N)">+ Add Pipette</button>
                </div>
            </div>
            <div style="text-align: right; font-size: 11px; color: #6c757d; margin-bottom: 10px;">
                ‚å®Ô∏è Shortcuts: <kbd style="background: #f0f0f0; padding: 2px 6px; border-radius: 3px; border: 1px solid #ccc;">Ctrl+N</kbd> New
                | <kbd style="background: #f0f0f0; padding: 2px 6px; border-radius: 3px; border: 1px solid #ccc;">Ctrl+D</kbd> Duplicate
                | <kbd style="background: #f0f0f0; padding: 2px 6px; border-radius: 3px; border: 1px solid #ccc;">Ctrl+S</kbd> Save
            </div>

            <!-- Barcode Scanner Status Bar -->
            <div class="scan-status-bar">
                <div class="scan-counter" id="scan-counter">üìä 0 scans today</div>
                <div class="scan-status" id="scan-status"></div>
                <div style="color: #6c757d; font-size: 12px;">
                    üí° Tip: Use barcode scanner to auto-fill serial numbers
                </div>
            </div>

            <!-- Bulk Actions Bar (hidden when no pipettes selected) -->
            <div id="bulkActionsBar" style="display: none; background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <label style="margin: 0; font-weight: 600;">
                            <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()"
                                   style="width: 18px; height: 18px; cursor: pointer; margin-right: 5px;">
                            Select All
                        </label>
                        <span id="selectedCount" style="color: #6c757d;">0 selected</span>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="bulkMarkStatus('PASS')" style="padding: 6px 16px; font-size: 13px;">
                            ‚úì Mark Selected as PASS
                        </button>
                        <button class="btn btn-danger" onclick="bulkMarkStatus('FAIL')" style="padding: 6px 16px; font-size: 13px;">
                            ‚úó Mark Selected as FAIL
                        </button>
                    </div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div id="progressText" style="text-align: center; margin-top: 8px; font-size: 14px; color: #6c757d; font-weight: 500;"></div>

            <div id="pipettesContainer">
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <h3 style="color: #6c757d; margin-bottom: 10px;">No Pipettes Added Yet</h3>
                    <p style="color: #adb5bd; margin-bottom: 30px;">Click "+ Add Pipette" to start your calibration</p>
                    <button class="btn btn-primary" onclick="addPipette()">
                        ‚ûï Add Your First Pipette
                    </button>
                </div>
            </div>
        </div>

        <!-- Summary Table Tab -->
        <div id="summary" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: #223077;">üìä Summary Table</h2>
                <button class="btn btn-secondary" onclick="exportToCSV()">üì• Export CSV</button>
            </div>

            <div class="table-container">
                <table class="pipette-table" id="summaryTable">
                    <thead>
                        <tr>
                            <th>No.</th>
                            <th>Manufacturer</th>
                            <th>Model</th>
                            <th>Max Vol</th>
                            <th>In Spec</th>
                            <th>Out Spec</th>
                            <th>Adjustments</th>
                            <th>Final Volumes</th>
                            <th>P/F</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="summaryTableBody">
                        <tr>
                            <td colspan="10" style="text-align: center; padding: 40px; color: #6c757d;">
                                No pipettes to display. Add pipettes in the Calibration tab.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Report Tab -->
        <div id="report" class="tab-content">
            <h2 style="color: #223077;">üìÑ Report</h2>
            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Print Report</button>
                <button class="btn btn-secondary" onclick="saveSession()">üíæ Save JSON</button>
            </div>
            <div id="reportContent" style="margin-top: 30px;">
                <!-- Report will be generated here -->
            </div>
        </div>

        <!-- Labels Tab -->
        <div id="labels" class="tab-content">
            <h2 style="color: #223077;">üè∑Ô∏è Print Labels</h2>

            <!-- Printer Status -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div>
                        <h3 style="margin: 0 0 10px 0; color: #223077;">üñ®Ô∏è Printer Status</h3>
                        <div id="printerStatus" style="color: #6c757d;">Checking for DYMO Connect...</div>
                    </div>
                    <button class="btn btn-secondary" onclick="checkDymoService()">üîÑ Refresh</button>
                </div>
                <div id="printerInfo" style="margin-top: 10px; font-size: 14px; color: #495057;"></div>
                <div id="dymoInstructions" style="display: none; margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;">
                    <strong>‚ö†Ô∏è DYMO Connect Not Detected</strong>
                    <p style="margin: 10px 0 0 0;">To print labels, you need:</p>
                    <ol style="margin: 10px 0 0 20px; padding: 0;">
                        <li>Download and install <a href="https://www.dymo.com/support?cfid=online-support-dls" target="_blank">DYMO Connect</a></li>
                        <li>Connect your DYMO LabelWriter 450</li>
                        <li>Make sure DYMO Connect software is running</li>
                        <li>Click "Refresh" above</li>
                    </ol>
                </div>
            </div>

            <!-- Pipette Selection -->
            <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6; margin: 20px 0;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                    <h3 style="margin: 0; color: #223077;">Select Pipettes to Print</h3>
                    <div>
                        <button class="btn btn-secondary" onclick="selectAllLabels()">‚òëÔ∏è Select All</button>
                        <button class="btn btn-secondary" onclick="deselectAllLabels()">‚òê Deselect All</button>
                    </div>
                </div>
                <div id="labelPipetteList" style="max-height: 400px; overflow-y: auto;">
                    <p style="color: #6c757d; text-align: center; padding: 40px;">No pipettes added yet. Go to the Calibration tab to add pipettes.</p>
                </div>
            </div>

            <!-- Label Options -->
            <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6; margin: 20px 0;">
                <h3 style="margin: 0 0 15px 0; color: #223077;">Label Options</h3>
                <div style="display: flex; gap: 20px; align-items: center;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Copies per Label:</label>
                        <input type="number" id="labelCopies" value="1" min="1" max="10"
                               style="width: 80px; padding: 8px; border: 1px solid #ced4da; border-radius: 4px;">
                    </div>
                    <div style="flex: 1;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Label Size:</label>
                        <select id="labelSize" style="width: 200px; padding: 8px; border: 1px solid #ced4da; border-radius: 4px;">
                            <option value="30334">1" √ó 1" (30334)</option>
                            <option value="30336">2-1/4" √ó 1-1/4" (30336)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Label Preview -->
            <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6; margin: 20px 0;">
                <h3 style="margin: 0 0 15px 0; color: #223077;">Label Preview</h3>
                <div id="labelPreview" style="display: flex; justify-content: center; align-items: center; min-height: 200px; background: #f8f9fa; border-radius: 6px; padding: 20px;">
                    <p style="color: #6c757d;">Select a pipette to preview its label</p>
                </div>
            </div>

            <!-- Print Button -->
            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-primary" onclick="printSelectedLabels()" style="font-size: 18px; padding: 15px 40px;">
                    üñ®Ô∏è Print Selected Labels
                </button>
                <div id="printStatus" style="margin-top: 15px; font-weight: 600;"></div>
            </div>
        </div>

        <!-- Inventory Used Tab -->
        <div id="inventory" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: #223077;">üì¶ Inventory Used</h2>
                <button onclick="openAddInventoryModal()" class="btn btn-primary">
                    ‚ú® Add Item Used
                </button>
            </div>

            <!-- Summary Stats -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); padding: 20px; border-radius: 12px; color: white;">
                    <div style="font-size: 2rem; font-weight: bold;" id="invTotalItems">0</div>
                    <div style="opacity: 0.9;">Items Used</div>
                </div>
                <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 20px; border-radius: 12px; color: white;">
                    <div style="font-size: 2rem; font-weight: bold;" id="invCurrentSession">0</div>
                    <div style="opacity: 0.9;">Current Session</div>
                </div>
                <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 20px; border-radius: 12px; color: white;">
                    <div style="font-size: 2rem; font-weight: bold;" id="invUniqueItems">0</div>
                    <div style="opacity: 0.9;">Unique Items</div>
                </div>
            </div>

            <!-- Usage Table -->
            <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h3 style="color: #223077; margin-bottom: 20px;">Items Used in Current Session</h3>
                <div id="inventoryUsageContainer" style="overflow-x: auto;">
                    <table id="inventoryUsageTable" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);">
                                <th style="padding: 15px; text-align: left; font-weight: 700; color: #374151; border-bottom: 2px solid #e5e7eb;">Item Name</th>
                                <th style="padding: 15px; text-align: center; font-weight: 700; color: #374151; border-bottom: 2px solid #e5e7eb;">Quantity</th>
                                <th style="padding: 15px; text-align: left; font-weight: 700; color: #374151; border-bottom: 2px solid #e5e7eb;">Job/Invoice</th>
                                <th style="padding: 15px; text-align: left; font-weight: 700; color: #374151; border-bottom: 2px solid #e5e7eb;">Used By</th>
                                <th style="padding: 15px; text-align: left; font-weight: 700; color: #374151; border-bottom: 2px solid #e5e7eb;">Time</th>
                                <th style="padding: 15px; text-align: left; font-weight: 700; color: #374151; border-bottom: 2px solid #e5e7eb;">Notes</th>
                                <th style="padding: 15px; text-align: center; font-weight: 700; color: #374151; border-bottom: 2px solid #e5e7eb;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryUsageBody">
                            <tr>
                                <td colspan="7" style="padding: 40px; text-align: center; color: #6c757d;">
                                    <div style="font-size: 3rem; opacity: 0.3; margin-bottom: 10px;">üì¶</div>
                                    <div>No items used yet. Click "Add Item Used" to log inventory usage.</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Export Section -->
            <div style="margin-top: 25px; text-align: right;">
                <button onclick="exportInventoryUsage()" class="btn btn-secondary" id="exportInventoryBtn">
                    üìÑ Export Usage Report
                </button>
                <button onclick="clearInventoryUsage()" class="btn btn-danger" id="clearInventoryBtn" style="margin-left: 10px;">
                    üóëÔ∏è Clear All Usage
                </button>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history" class="tab-content">
            <h2 style="color: #223077;">üìö Session History</h2>
            <div id="historyContainer" style="margin-top: 20px;">
                <p style="color: #6c757d;">No previous sessions found.</p>
            </div>
        </div>
    </div>

    <!-- Add Inventory Usage Modal -->
    <div id="addInventoryModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 1000; animation: fadeIn 0.3s ease;">
        <div style="background: white; margin: 50px auto; padding: 30px; border-radius: 20px; width: 90%; max-width: 600px; box-shadow: 0 25px 50px rgba(0,0,0,0.2); animation: slideUp 0.3s ease;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #e5e7eb;">
                <h2 style="color: #1f2937; font-size: 1.5rem; margin: 0;">üì¶ Add Item Used</h2>
                <button onclick="closeInventoryModal()" style="background: none; border: none; font-size: 28px; cursor: pointer; color: #6b7280; transition: color 0.3s ease;">&times;</button>
            </div>
            <form id="addInventoryForm">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Item Name *</label>
                    <input type="text" id="invItemName" required style="width: 100%; padding: 12px 15px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; transition: border-color 0.3s ease;" placeholder="e.g., Seal P1000, O-ring R200">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Quantity Used *</label>
                    <input type="number" id="invQuantity" min="1" required style="width: 100%; padding: 12px 15px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; transition: border-color 0.3s ease;" placeholder="1">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Job/Invoice Number</label>
                    <input type="text" id="invJobNumber" style="width: 100%; padding: 12px 15px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; transition: border-color 0.3s ease;" placeholder="e.g., CAL-2024-001">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Used By</label>
                    <input type="text" id="invUsedBy" style="width: 100%; padding: 12px 15px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; transition: border-color 0.3s ease;" placeholder="Technician name">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Notes</label>
                    <textarea id="invNotes" rows="3" style="width: 100%; padding: 12px 15px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; transition: border-color 0.3s ease; resize: vertical;" placeholder="Optional notes about usage"></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    ‚ú® Add Item Used
                </button>
            </form>
        </div>
    </div>
</body>
</html>
